<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Raffle Number Game - Prototype</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* ===== RESET & BASE STYLES ===== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }

        /* ===== SCREEN CONTAINERS ===== */
        .screen {
            max-width: 500px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
            animation: slideUp 0.5s ease;
        }

        @keyframes slideUp {
            from { transform: translateY(50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .hidden {
            display: none !important;
        }

        /* ===== LOGIN SCREEN ===== */
        .login-form {
            padding: 40px;
            text-align: center;
        }

        .logo {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 40px 20px;
            text-align: center;
        }

        .logo i {
            font-size: 60px;
            margin-bottom: 20px;
        }

        .logo h1 {
            font-size: 32px;
        }

        .input-group {
            display: flex;
            align-items: center;
            background: #f5f5f5;
            border-radius: 10px;
            padding: 15px;
            margin: 15px 0;
        }

        .input-group i {
            color: #667eea;
            margin-right: 10px;
            font-size: 20px;
        }

        .input-group input {
            border: none;
            background: transparent;
            font-size: 16px;
            width: 100%;
            outline: none;
        }

        /* ===== BUTTONS ===== */
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 10px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            width: 100%;
            margin: 10px 0;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            transition: transform 0.2s;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            cursor: pointer;
            width: 100%;
            margin: 5px 0;
        }

        .btn-success {
            background: #28a745;
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            width: 100%;
            transition: all 0.3s;
        }

        .btn-success:hover {
            background: #218838;
            transform: translateY(-2px);
        }

        .btn-success:active {
            background: #1e7e34;
            transform: translateY(0);
        }

        .btn-success.placed {
            background: #dc3545;
            animation: pulse 0.5s;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(0.95); }
            100% { transform: scale(1); }
        }

        .btn-warning {
            background: #ffc107;
            color: #212529;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
        }

        .btn-icon {
            background: none;
            border: none;
            font-size: 16px;
            color: white;
            cursor: pointer;
            padding: 10px;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        /* ===== DEMO USERS ===== */
        .demo-users {
            margin: 20px 0;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
        }

        .user-badges {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            justify-content: center;
            margin: 10px 0;
        }

        .user-badges span {
            background: #667eea;
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .user-badges span:hover {
            background: #764ba2;
            transform: scale(1.05);
        }

        /* ===== HEADER ===== */
        header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        header h2 {
            font-size: 18px;
            text-align: center;
            flex: 1;
        }

        .balance {
            background: rgba(255,255,255,0.2);
            padding: 8px 15px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 14px;
        }

        /* ===== TABS ===== */
        .tabs {
            display: flex;
            background: #f8f9fa;
            padding: 10px;
        }

        .tab {
            flex: 1;
            padding: 15px;
            border: none;
            background: none;
            cursor: pointer;
            font-size: 14px;
            color: #666;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
        }

        .tab.active {
            color: #667eea;
            border-bottom: 3px solid #667eea;
        }

        .tab-content {
            padding: 20px;
            display: none;
            min-height: 400px;
        }

        .tab-content.active {
            display: block;
        }

        /* ===== RAFFLE ITEMS ===== */
        .items-grid {
            display: grid;
            gap: 15px;
        }

        .item-card {
            border: 2px solid #e0e0e0;
            border-radius: 15px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .item-card:hover {
            border-color: #667eea;
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }

        .item-card h4 {
            color: #667eea;
            margin-bottom: 5px;
        }

        .item-card img {
            width: 100%;
            height: 150px;
            object-fit: cover;
            border-radius: 10px;
            margin: 10px 0;
        }

        .item-info {
            display: flex;
            justify-content: space-between;
            margin-top: 10px;
            font-size: 14px;
            color: #666;
        }

        /* ===== WALLET ===== */
        .wallet-info {
            text-align: center;
        }

        .balance-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            border-radius: 15px;
            margin: 20px 0;
        }

        .balance-card .amount {
            font-size: 40px;
            font-weight: bold;
            margin: 10px 0;
            letter-spacing: 1px;
        }

        .deposits {
            margin: 20px 0;
        }

        .deposit-item {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            margin: 10px 0;
            border-left: 5px solid #28a745;
        }

        .deposit-item.expiring {
            border-left-color: #ffc107;
            background: #fff3cd;
        }

        .deposit-item.expired {
            border-left-color: #dc3545;
            background: #f8d7da;
        }

        /* ===== MODALS ===== */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .modal-content {
            background: white;
            width: 90%;
            max-width: 500px;
            border-radius: 20px;
            padding: 30px;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
        }

        .close-btn {
            position: absolute;
            top: 15px;
            right: 15px;
            background: none;
            border: none;
            font-size: 30px;
            cursor: pointer;
            color: #666;
        }

        /* ===== CALCULATOR ===== */
        .calculator {
            display: grid;
            gap: 10px;
            margin: 20px 0;
        }

        .calc-row {
            display: flex;
            gap: 10px;
        }

        .calc-btn {
            flex: 1;
            padding: 20px;
            font-size: 24px;
            border: 2px solid #e0e0e0;
            background: white;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .calc-btn:hover {
            background: #f8f9fa;
            border-color: #667eea;
        }

        .number-display {
            text-align: center;
            margin: 20px 0;
        }

        #bet-number {
            font-size: 36px;
            text-align: center;
            border: 3px solid #667eea;
            border-radius: 10px;
            padding: 15px;
            width: 100%;
            background: #f8f9fa;
            font-weight: bold;
            letter-spacing: 2px;
            font-family: monospace;
            color: #999;
            transition: all 0.3s;
        }

        #bet-number.has-value {
            color: #28a745;
            background: #f8fff9;
            border-color: #28a745;
        }

        /* ===== CASH IN OPTIONS ===== */
        .cashin-options {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin: 20px 0;
        }

        .cashin-option {
            padding: 25px;
            background: #f8f9fa;
            border: 2px solid #dee2e6;
            border-radius: 10px;
            font-size: 20px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s;
        }

        .cashin-option:hover {
            background: #667eea;
            color: white;
            border-color: #667eea;
            transform: scale(1.05);
        }

        /* ===== ADMIN STYLES ===== */
        .admin-content {
            padding: 20px;
        }

        .admin-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }

        .admin-stats-4 {
            grid-template-columns: repeat(4, 1fr);
        }

        .stat-card {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            border: 2px solid #e0e0e0;
        }

        .stat-card.pot-money {
            background: linear-gradient(135deg, #ff9800 0%, #ff5722 100%);
            color: white;
            border-color: #ff9800;
        }

        .stat-card.pot-money div {
            color: white;
        }

        .stat-card div {
            font-size: 20px;
            font-weight: bold;
            color: #667eea;
            margin-top: 5px;
        }

        /* ===== BET LIST ===== */
        .bet-item {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            margin: 10px 0;
            border-left: 5px solid #667eea;
            cursor: pointer;
            transition: all 0.3s;
        }

        .bet-item.won {
            border-left-color: #28a745;
            background: #d4edda;
        }

        .bet-item.refunded {
            border-left-color: #6c757d;
            background: #e9ecef;
        }

        .bet-item.inactive {
            border-left-color: #6c757d;
            background: #f8f9fa;
            opacity: 0.7;
        }

        /* ===== NOTIFICATIONS ===== */
        .notification {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: #28a745;
            color: white;
            padding: 15px 25px;
            border-radius: 10px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
            z-index: 1001;
            animation: slideInRight 0.3s ease;
        }

        .notification.warning {
            background: #ffc107;
            color: #212529;
        }

        .notification.error {
            background: #dc3545;
        }

        .notification.info {
            background: #17a2b8;
        }

        @keyframes slideInRight {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        /* ===== RESPONSIVE ===== */
        @media (max-width: 600px) {
            body {
                padding: 10px;
            }
            
            .login-form {
                padding: 20px;
            }
            
            .logo {
                padding: 30px 20px;
            }
            
            .tab {
                font-size: 12px;
                padding: 10px 5px;
            }
            
            .admin-stats {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .admin-stats-4 {
                grid-template-columns: repeat(2, 1fr);
            }
            
            #bet-number {
                font-size: 28px;
                padding: 12px;
            }
            
            .balance-card .amount {
                font-size: 32px;
            }
        }
        
        /* ===== DECIMAL FORMATTING ===== */
        .decimal-format {
            font-family: monospace;
            letter-spacing: 1px;
        }
        
        /* ===== FORM LABELS ===== */
        .form-label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #667eea;
            font-size: 14px;
        }
        
        .datetime-input {
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            width: 100%;
            font-size: 14px;
        }
        
        /* ===== SERVICE FEE DISPLAY ===== */
        .service-fee {
            color: #dc3545;
            font-size: 12px;
            margin-top: 5px;
        }
        
        /* ===== TRANSFER BUTTONS ===== */
        .transfer-buttons {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }
        
        .transfer-btn {
            flex: 1;
            padding: 12px;
            border-radius: 8px;
            border: none;
            font-weight: bold;
            cursor: pointer;
        }
        
        .shopee-btn {
            background: #ee4d2d;
            color: white;
        }
        
        .lazada-btn {
            background: #0d1464;
            color: white;
        }
        
        /* ===== COUNTDOWN TIMER ===== */
        .countdown {
            font-size: 12px;
            color: #666;
            background: #f8f9fa;
            padding: 5px 10px;
            border-radius: 15px;
            display: inline-block;
            margin-top: 5px;
        }
        
        /* ===== MANUAL BET SECTION ===== */
        .manual-bet-section {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            margin: 20px 0;
            border-left: 5px solid #667eea;
        }
        
        /* ===== AUTO BET SECTION ===== */
        .auto-bet-section {
            background: #fff3cd;
            padding: 15px;
            border-radius: 10px;
            margin: 20px 0;
            border-left: 5px solid #ffc107;
        }
        
        .auto-bet-controls {
            display: grid;
            gap: 10px;
            margin-top: 10px;
        }
        
        .auto-bet-btn {
            background: #fd7e14;
            color: white;
            border: none;
            padding: 12px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .auto-bet-btn:hover {
            background: #e96b00;
        }
        
        .auto-bet-btn:disabled {
            background: #6c757d;
            cursor: not-allowed;
        }
        
        .auto-bet-status {
            text-align: center;
            margin-top: 10px;
            font-size: 14px;
            color: #666;
        }
        
        /* ===== AUTO BET NUMBERS DISPLAY ===== */
        .auto-numbers-display {
            max-height: 150px;
            overflow-y: auto;
            margin: 10px 0;
            padding: 10px;
            background: white;
            border-radius: 8px;
            border: 2px solid #dee2e6;
        }
        
        .auto-numbers-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 5px;
        }
        
        .auto-number-badge {
            background: #e9ecef;
            padding: 5px;
            border-radius: 5px;
            font-size: 11px;
            font-family: monospace;
            text-align: center;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        /* ===== BALANCE SUMMARY ===== */
        .balance-summary {
            background: #e9ecef;
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
        }
        
        .balance-row {
            display: flex;
            justify-content: space-between;
            margin: 5px 0;
        }
        
        .balance-label {
            color: #666;
        }
        
        .balance-value {
            font-weight: bold;
            font-family: monospace;
        }
        
        .fee-warning {
            color: #dc3545;
            font-size: 12px;
            margin-top: 10px;
            text-align: center;
        }
        
        /* ===== PLACE GAME BUTTON ===== */
        .place-game-btn-container {
            margin: 15px 0;
        }
        
        .place-game-btn {
            background: #28a745;
            color: white;
            border: none;
            padding: 20px;
            border-radius: 15px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            width: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            transition: all 0.3s;
            animation: pulse-btn 2s infinite;
        }
        
        @keyframes pulse-btn {
            0% { transform: scale(1); box-shadow: 0 5px 15px rgba(40, 167, 69, 0.4); }
            50% { transform: scale(1.02); box-shadow: 0 8px 20px rgba(40, 167, 69, 0.6); }
            100% { transform: scale(1); box-shadow: 0 5px 15px rgba(40, 167, 69, 0.4); }
        }
        
        .place-game-btn:hover {
            background: #218838;
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(40, 167, 69, 0.6);
        }
        
        .place-game-btn:active {
            transform: translateY(0);
        }
        
        .place-game-btn.placed {
            background: #dc3545;
            animation: none;
            transform: scale(0.98);
        }
        
        .place-game-btn:disabled {
            background: #6c757d;
            cursor: not-allowed;
            animation: none;
            transform: none;
        }
        
        .place-game-btn.placed:hover {
            background: #c82333;
        }
        
        /* ===== WALLET TRANSFER BUTTONS ===== */
        .wallet-transfer-btn {
            background: #17a2b8;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 12px;
            margin-left: 10px;
        }
        
        .wallet-transfer-btn:hover {
            background: #138496;
        }
        
        .wallet-transfer-btn:disabled {
            background: #6c757d;
            cursor: not-allowed;
        }
        
        /* ===== BET DETAILS MODAL ===== */
        .bet-numbers-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 10px;
            margin: 15px 0;
            max-height: 300px;
            overflow-y: auto;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 10px;
        }
        
        .bet-number-item {
            background: white;
            padding: 10px;
            border-radius: 5px;
            text-align: center;
            font-family: monospace;
            border: 1px solid #dee2e6;
        }
        
        .bet-total {
            background: #e9ecef;
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
            text-align: center;
            font-weight: bold;
        }
        
        /* ===== WINNER ITEMS SECTION ===== */
        .winner-items-section {
            margin: 20px 0;
            padding: 20px;
            background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%);
            border-radius: 15px;
            border-left: 5px solid #28a745;
        }
        
        .winner-items-grid {
            display: grid;
            gap: 15px;
            margin-top: 15px;
        }
        
        .winner-item-card {
            background: white;
            border-radius: 10px;
            padding: 15px;
            border: 2px solid #28a745;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .winner-item-card img {
            width: 100%;
            height: 120px;
            object-fit: cover;
            border-radius: 8px;
            margin: 10px 0;
        }
        
        /* ===== WALLET LOGS ===== */
        .wallet-logs {
            margin: 20px 0;
        }
        
        .log-item {
            background: #f8f9fa;
            padding: 12px;
            border-radius: 8px;
            margin: 8px 0;
            border-left: 4px solid #17a2b8;
            font-size: 14px;
        }
        
        .log-item.refund {
            border-left-color: #28a745;
            background: #d4edda;
        }
        
        .log-item.bet {
            border-left-color: #667eea;
            background: #e0e7ff;
        }
        
        .log-item.transfer-fee {
            border-left-color: #dc3545;
            background: #f8d7da;
        }
        
        .log-item.send {
            border-left-color: #ffc107;
            background: #fff3cd;
        }
        
        .log-item.win {
            border-left-color: #20c997;
            background: #d1f2eb;
        }
        
        /* ===== ADMIN WINNERS LIST ===== */
        .winners-list {
            margin-top: 20px;
            max-height: 300px;
            overflow-y: auto;
        }
        
        .winner-card {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            margin: 10px 0;
            border-left: 5px solid #28a745;
            cursor: pointer;
        }
        
        .winner-card:hover {
            background: #e9ecef;
            transform: translateY(-2px);
        }
        
        /* ===== INACTIVE ITEM STYLES ===== */
        .item-card.inactive {
            opacity: 0.6;
            cursor: not-allowed;
            border-color: #6c757d;
        }
        
        .item-card.inactive:hover {
            transform: none;
            box-shadow: none;
            border-color: #6c757d;
        }
        
        .btn-disabled {
            background: #6c757d !important;
            cursor: not-allowed !important;
            opacity: 0.6;
        }
        
        .btn-disabled:hover {
            transform: none !important;
            box-shadow: none !important;
        }
        
        /* ===== COLLAPSIBLE SECTIONS ===== */
        .collapsible-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            padding: 10px 15px;
            background: #f8f9fa;
            border-radius: 10px;
            margin: 15px 0;
            border-left: 5px solid #667eea;
        }
        
        .collapsible-header:hover {
            background: #e9ecef;
        }
        
        .collapsible-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-out;
        }
        
        .collapsible-content.expanded {
            max-height: 800px; /* Increased from 500px for bigger sections */
        }
        
        /* Special bigger sections */
        .collapsible-content.big-section.expanded {
            max-height: 1200px; /* Even bigger for specific sections */
        }
        
        .collapsible-icon {
            transition: transform 0.3s;
        }
        
        .collapsible-icon.expanded {
            transform: rotate(180deg);
        }
        
        .view-all-btn {
            background: #6c757d;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 12px;
            cursor: pointer;
            margin-top: 10px;
            display: block;
            width: 100%;
            text-align: center;
        }
        
        .view-all-btn:hover {
            background: #5a6268;
        }
        
        /* ===== CASH OUT POT ===== */
        .cashout-btn {
            background: #28a745;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
        }
        
        .cashout-btn:hover {
            background: #218838;
            transform: translateY(-2px);
        }
        
        .cashout-btn:active {
            transform: translateY(0);
        }
        
        .pot-container {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 15px;
        }
        
        /* ===== SCROLLABLE COLLAPSIBLE ===== */
        .scrollable-content {
            max-height: 250px; /* Increased from 150px for bigger sections */
            overflow-y: auto;
            margin: 10px 0;
            padding-right: 5px;
        }
        
        /* Special bigger scrollable sections */
        .scrollable-content.big-scroll {
            max-height: 350px; /* Even bigger scrollable area */
        }
        
        .scrollable-content::-webkit-scrollbar {
            width: 6px;
        }
        
        .scrollable-content::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }
        
        .scrollable-content::-webkit-scrollbar-thumb {
            background: #667eea;
            border-radius: 10px;
        }
        
        .scrollable-content::-webkit-scrollbar-thumb:hover {
            background: #764ba2;
        }
    </style>
</head>
<body>
    <!-- LOGIN SCREEN -->
    <div id="login-screen" class="screen">
        <div class="logo">
            <i class="fas fa-ticket-alt"></i>
            <h1>Raffle Number Game</h1>
            <p>Prototype v888</p>
        </div>
        
        <div class="login-form">
            <h2>Login to Play</h2>
            <p style="color: #666; margin-bottom: 20px;">Demo: Use username 1-5 with same password</p>
            
            <div class="input-group">
                <i class="fas fa-user"></i>
                <input type="text" id="username" placeholder="Enter username (1-5)" maxlength="20">
            </div>
            
            <div class="input-group">
                <i class="fas fa-lock"></i>
                <input type="password" id="password" placeholder="Enter password" value="1">
            </div>
            
            <button onclick="login()" class="btn-primary">
                <i class="fas fa-sign-in-alt"></i> Login to Game
            </button>
            
            <div class="demo-users">
                <h3>Quick Login (Click Any):</h3>
                <div class="user-badges">
                    <span onclick="fillLogin('1', '1')">User 1</span>
                    <span onclick="fillLogin('2', '2')">User 2</span>
                    <span onclick="fillLogin('3', '3')">User 3</span>
                    <span onclick="fillLogin('4', '4')">User 4</span>
                    <span onclick="fillLogin('5', '5')">User 5</span>
                </div>
                <p><small>All start with ‚Ç±50.000 play money</small></p>
            </div>
            
            <div class="admin-login" style="margin-top: 30px;">
                <button onclick="adminLogin()" class="btn-secondary">
                    <i class="fas fa-cog"></i> Admin Login (Username: admin, Password: secret123)
                </button>
            </div>
        </div>
    </div>

    <!-- USER DASHBOARD -->
    <div id="user-dashboard" class="screen hidden">
        <header>
            <button onclick="logout()" class="btn-icon" title="Logout">
                <i class="fas fa-sign-out-alt"></i> Logout
            </button>
            <h2>Welcome, <span id="current-user" style="color: #ffeb3b;">User</span></h2>
            <div class="balance">
                <i class="fas fa-wallet"></i>
                ‚Ç±<span id="user-balance" class="decimal-format">50.000</span>
            </div>
        </header>
        
        <nav class="tabs">
            <button class="tab" onclick="showTab('play')">
                <i class="fas fa-gamepad"></i> Play
            </button>
            <button class="tab active" onclick="showTab('wallet')">
                <i class="fas fa-wallet"></i> Wallet
            </button>
            <button class="tab" onclick="showTab('bets')">
                <i class="fas fa-history"></i> My Bets
            </button>
            <button class="tab" onclick="showTab('wins')">
                <i class="fas fa-trophy"></i> My Wins
            </button>
            <button class="tab" onclick="showTab('send')">
                <i class="fas fa-paper-plane"></i> Send
            </button>
        </nav>
        
        <!-- PLAY TAB -->
        <div id="play-tab" class="tab-content">
            <h3 style="margin-bottom: 20px; color: #667eea;">üéØ Active Raffles</h3>
            <div class="collapsible-header" onclick="toggleCollapsible('active-raffles')">
                <h4 style="margin: 0; color: #667eea;">
                    <i class="fas fa-ticket-alt"></i> Active Raffles
                </h4>
                <i class="fas fa-chevron-down collapsible-icon" id="active-raffles-icon"></i>
            </div>
            <div class="collapsible-content big-section expanded" id="active-raffles-content">
                <div class="scrollable-content big-scroll">
                    <div id="raffle-items" class="items-grid">
                        <!-- Items loaded by JavaScript -->
                    </div>
                </div>
            </div>
            <p style="text-align: center; color: #666; margin-top: 20px; font-size: 14px;">
                Tap any item to place your bet
            </p>
        </div>
        
        <!-- WALLET TAB -->
        <div id="wallet-tab" class="tab-content active">
            <div class="wallet-info">
                <h3 style="color: #667eea; margin-bottom: 20px;">üí∞ My Wallet</h3>
                
                <div class="balance-card">
                    <h4>Available Play Money</h4>
                    <div class="amount decimal-format" id="wallet-balance">‚Ç±50.000</div>
                    <p>Use for betting only</p>
                </div>
                
                <!-- Wallet Logs Section -->
                <div class="wallet-logs">
                    <div class="collapsible-header" onclick="toggleCollapsible('wallet-logs')">
                        <h4 style="margin: 0; color: #667eea;">
                            <i class="fas fa-file-alt"></i> Wallet Logs
                        </h4>
                        <i class="fas fa-chevron-down collapsible-icon" id="wallet-logs-icon"></i>
                    </div>
                    <div class="collapsible-content big-section expanded" id="wallet-logs-content">
                        <div class="scrollable-content big-scroll">
                            <div id="wallet-logs-list">
                                <!-- Wallet logs loaded here -->
                            </div>
                        </div>
                        <button class="view-all-btn" onclick="viewAllLogs()">View All Logs</button>
                    </div>
                </div>
                
                <div class="deposits">
                    <div class="collapsible-header" onclick="toggleCollapsible('deposits')">
                        <h4 style="margin: 0; color: #667eea;">
                            <i class="fas fa-calendar-alt"></i> Active Deposits
                        </h4>
                        <i class="fas fa-chevron-down collapsible-icon" id="deposits-icon"></i>
                    </div>
                    <div class="collapsible-content expanded" id="deposits-content">
                        <div class="scrollable-content">
                            <div id="deposits-list">
                                <!-- Deposits loaded here -->
                            </div>
                        </div>
                        <button class="view-all-btn" onclick="viewAllDeposits()">View All Deposits</button>
                        <p style="color: #666; font-size: 12px; margin-top: 10px;">
                            ‚è∞ Deposits expire in 5 days. You'll be notified before expiry.
                        </p>
                    </div>
                </div>
                
                <button onclick="showCashIn()" class="btn-primary" style="margin-top: 30px;">
                    <i class="fas fa-plus-circle"></i> Cash In More Money
                </button>
                
                <div style="margin-top: 20px; padding: 15px; background: #f0f8ff; border-radius: 10px;">
                    <h4 style="color: #667eea;">üè¶ Wallet Info</h4>
                    <p style="margin: 10px 0;">Shopee Wallet: <span id="shopee-wallet"></span> 
                        <button class="wallet-transfer-btn" onclick="transferToShopee()">Transfer</button>
                    </p>
                    <p>Lazada Wallet: <span id="lazada-wallet"></span>
                        <button class="wallet-transfer-btn" onclick="transferToLazada()">Transfer</button>
                    </p>
                    <button onclick="showWalletSetup()" class="btn-secondary" style="margin-top: 10px;">
                        Setup Wallets
                    </button>
                </div>
                
                <div style="margin-top: 20px; padding: 15px; background: #f8f9fa; border-radius: 10px;">
                    <h4 style="color: #667eea;">‚ÑπÔ∏è Service Information</h4>
                    <p style="margin: 5px 0; font-size: 14px;">‚Ä¢ 2% service fee for wallet transfers</p>
                    <p style="margin: 5px 0; font-size: 14px;">‚Ä¢ 2% service fee on refunded bets (when no winner)</p>
                    <p style="margin: 5px 0; font-size: 14px;">‚Ä¢ Deposits expire in 5 days</p>
                </div>
            </div>
        </div>
        
        <!-- MY BETS TAB -->
        <div id="bets-tab" class="tab-content">
            <h3 style="color: #667eea; margin-bottom: 20px;">üìä My Betting History</h3>
            <div class="collapsible-header" onclick="toggleCollapsible('betting-history')">
                <h4 style="margin: 0; color: #667eea;">
                    <i class="fas fa-history"></i> My Bets
                </h4>
                <i class="fas fa-chevron-down collapsible-icon" id="betting-history-icon"></i>
            </div>
            <div class="collapsible-content expanded" id="betting-history-content">
                <div class="scrollable-content">
                    <div id="bets-list">
                        <!-- Bets loaded here -->
                    </div>
                </div>
                <button class="view-all-btn" onclick="viewAllBets()">View All Bets</button>
            </div>
        </div>
        
        <!-- MY WINS TAB -->
        <div id="wins-tab" class="tab-content">
            <h3 style="color: #667eea; margin-bottom: 20px;">üèÜ My Winning Items</h3>
            <div class="collapsible-header" onclick="toggleCollapsible('my-wins')">
                <h4 style="margin: 0; color: #667eea;">
                    <i class="fas fa-trophy"></i> My Wins
                </h4>
                <i class="fas fa-chevron-down collapsible-icon" id="my-wins-icon"></i>
            </div>
            <div class="collapsible-content big-section expanded" id="my-wins-content">
                <div class="scrollable-content big-scroll">
                    <div id="wins-list" class="winner-items-grid">
                        <!-- Winning items loaded here -->
                    </div>
                </div>
                <button class="view-all-btn" onclick="viewAllWins()">View All Wins</button>
            </div>
        </div>
        
        <!-- SEND MONEY TAB -->
        <div id="send-tab" class="tab-content">
            <h3 style="color: #667eea; margin-bottom: 20px;">üí∏ Send Play Money</h3>
            <div style="background: #f8f9fa; padding: 20px; border-radius: 15px;">
                <div style="margin-bottom: 15px;">
                    <label style="display: block; margin-bottom: 5px; font-weight: bold;">Recipient Username:</label>
                    <input type="text" id="recipient" placeholder="Enter username" style="width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 8px;">
                </div>
                
                <div style="margin-bottom: 15px;">
                    <label style="display: block; margin-bottom: 5px; font-weight: bold;">Amount to Send:</label>
                    <input type="number" id="send-amount" placeholder="‚Ç± Amount" min="0.001" step="0.001" style="width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 8px;">
                </div>
                
                <div style="background: #fff3cd; padding: 10px; border-radius: 5px; margin-bottom: 15px;">
                    <p style="margin: 0; font-size: 14px; color: #856404;">
                        <i class="fas fa-info-circle"></i> No service fee for peer-to-peer transfers
                    </p>
                </div>
                
                <button onclick="sendMoney()" class="btn-primary">
                    <i class="fas fa-paper-plane"></i> Send Now
                </button>
                
                <p style="margin-top: 20px; color: #666; font-size: 14px;">
                    üí° You can only send to existing users. Money will be deducted from your balance.
                </p>
            </div>
        </div>
    </div>

    <!-- ADMIN DASHBOARD -->
    <div id="admin-dashboard" class="screen hidden">
        <header>
            <button onclick="logout()" class="btn-icon" title="Logout">
                <i class="fas fa-sign-out-alt"></i> Logout
            </button>
            <h2><i class="fas fa-cog"></i> Admin Control Panel</h2>
        </header>
        
        <div class="admin-content">
            <!-- Total Money Pot with Cash Out Button -->
            <div class="pot-container">
                <div class="stat-card pot-money">
                    <h4>Total Money Pot</h4>
                    <div id="total-pot-money" class="decimal-format">‚Ç±0.000</div>
                    <small>Winner bets go here</small>
                </div>
                <button class="cashout-btn" onclick="cashOutPot()">
                    <i class="fas fa-money-bill-wave"></i> Cash Out Pot
                </button>
            </div>
            
            <div class="admin-stats admin-stats-4">
                <div class="stat-card">
                    <h4>Total Users</h4>
                    <div id="total-users">5</div>
                </div>
                <div class="stat-card">
                    <h4>Total Balance</h4>
                    <div id="total-balance" class="decimal-format">‚Ç±250.000</div>
                </div>
                <div class="stat-card">
                    <h4>Active Raffles</h4>
                    <div id="active-raffles">3</div>
                </div>
                <div class="stat-card">
                    <h4>Total Bets</h4>
                    <div id="total-bets">0</div>
                </div>
                <div class="stat-card">
                    <h4>Winners</h4>
                    <div id="total-winners">0</div>
                </div>
                <div class="stat-card">
                    <h4>Service Fees</h4>
                    <div id="total-fees" class="decimal-format">‚Ç±0.000</div>
                </div>
            </div>
            
            <div class="admin-actions" style="margin-top: 30px;">
                <button onclick="showAddItem()" class="btn-primary" style="margin-bottom: 20px;">
                    <i class="fas fa-plus-circle"></i> Add New Raffle Item
                </button>
                
                <!-- All Users Section -->
                <div class="collapsible-header" onclick="toggleCollapsible('admin-users')">
                    <h4 style="margin: 0; color: #667eea;">
                        <i class="fas fa-users"></i> All Users
                    </h4>
                    <i class="fas fa-chevron-down collapsible-icon" id="admin-users-icon"></i>
                </div>
                <div class="collapsible-content expanded" id="admin-users-content">
                    <div class="scrollable-content">
                        <div id="users-list" style="max-height: 200px; overflow-y: auto;">
                            <!-- Users loaded here -->
                        </div>
                    </div>
                </div>
                <button class="view-all-btn" onclick="viewAllUsers()">View All Users</button>
                
                <!-- Winners List Section -->
                <div class="collapsible-header" onclick="toggleCollapsible('admin-winners')">
                    <h4 style="margin: 0; color: #667eea;">
                        <i class="fas fa-trophy"></i> Winners List
                    </h4>
                    <i class="fas fa-chevron-down collapsible-icon" id="admin-winners-icon"></i>
                </div>
                <div class="collapsible-content expanded" id="admin-winners-content">
                    <div class="scrollable-content">
                        <div id="winners-list" class="winners-list">
                            <!-- Winners loaded here -->
                        </div>
                    </div>
                </div>
                <button class="view-all-btn" onclick="viewAllWinners()">View All Winners</button>
                
                <!-- Raffle Items Section -->
                <div class="collapsible-header" onclick="toggleCollapsible('admin-items')">
                    <h4 style="margin: 0; color: #667eea;">
                        <i class="fas fa-ticket-alt"></i> Raffle Items
                    </h4>
                    <i class="fas fa-chevron-down collapsible-icon" id="admin-items-icon"></i>
                </div>
                <div class="collapsible-content expanded" id="admin-items-content">
                    <div class="scrollable-content">
                        <div id="admin-items-list" style="max-height: 300px; overflow-y: auto;">
                            <!-- Items loaded here -->
                        </div>
                    </div>
                </div>
                <button class="view-all-btn" onclick="viewAllItems()">View All Items</button>
                
                <div style="margin-top: 30px; padding: 15px; background: #f8f9fa; border-radius: 10px;">
                    <h4 style="color: #667eea;">‚öôÔ∏è Admin Tools</h4>
                    <button onclick="checkAutoDraws()" class="btn-secondary" style="margin: 10px 5px;">
                        Check Auto Draws
                    </button>
                    <button onclick="checkExpirations()" class="btn-secondary" style="margin: 10px 5px;">
                        Check Expirations
                    </button>
                    <button onclick="resetAllData()" class="btn-secondary" style="margin: 10px 5px;">
                        Reset Demo Data
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- GAME MODAL -->
    <div id="game-modal" class="modal hidden">
        <div class="modal-content">
            <button onclick="closeModal()" class="close-btn">&times;</button>
            <h3 id="item-name" style="color: #667eea; text-align: center;">Loading...</h3>
            <img id="item-image" src="https://images.unsplash.com/photo-1511707171634-5f897ff02aa9?w=400&h=200&fit=crop" alt="Item" style="width: 100%; height: 200px; object-fit: cover; border-radius: 10px; margin: 15px 0;">
            
            <div class="betting-interface">
                <div class="number-display">
                    <input type="text" id="bet-number" value="0.000" readonly style="font-size: 36px; padding: 15px;" class="decimal-format">
                </div>
                
                <p style="text-align: center; color: #666; margin: 10px 0;">
                    Enter your unique number (format: X.XXX where X=0-9)
                </p>
                
                <!-- MANUAL BET SECTION -->
                <div class="manual-bet-section">
                    <h4 style="color: #667eea; margin-bottom: 15px; text-align: center;">
                        <i class="fas fa-keyboard"></i> Manual Betting
                    </h4>
                    
                    <div class="calculator">
                        <div class="calc-row">
                            <button class="calc-btn" onclick="addNumber('1')">1</button>
                            <button class="calc-btn" onclick="addNumber('2')">2</button>
                            <button class="calc-btn" onclick="addNumber('3')">3</button>
                        </div>
                        <div class="calc-row">
                            <button class="calc-btn" onclick="addNumber('4')">4</button>
                            <button class="calc-btn" onclick="addNumber('5')">5</button>
                            <button class="calc-btn" onclick="addNumber('6')">6</button>
                        </div>
                        <div class="calc-row">
                            <button class="calc-btn" onclick="addNumber('7')">7</button>
                            <button class="calc-btn" onclick="addNumber('8')">8</button>
                            <button class="calc-btn" onclick="addNumber('9')">9</button>
                        </div>
                        <div class="calc-row">
                            <button class="calc-btn" onclick="addNumber('.')">.</button>
                            <button class="calc-btn" onclick="addNumber('0')">0</button>
                            <button class="calc-btn" onclick="clearNumber()">C</button>
                        </div>
                    </div>
                    
                    <!-- MANUAL BET BALANCE SUMMARY -->
                    <div class="balance-summary" id="manual-balance-summary">
                        <div class="balance-row">
                            <span class="balance-label">Your Balance:</span>
                            <span class="balance-value decimal-format" id="manual-balance">‚Ç±50.000</span>
                        </div>
                        <div class="balance-row">
                            <span class="balance-label">Bet Amount:</span>
                            <span class="balance-value decimal-format" id="manual-bet-amount">‚Ç±0.000</span>
                        </div>
                        <div class="balance-row">
                            <span class="balance-label">After Bet:</span>
                            <span class="balance-value decimal-format" id="manual-after-bet">‚Ç±50.000</span>
                        </div>
                        <div class="fee-warning" id="manual-fee-warning"></div>
                    </div>
                    
                    <!-- MANUAL PLACE GAME BUTTON -->
                    <div class="place-game-btn-container">
                        <button class="place-game-btn" id="manual-place-game-btn" onclick="placeBet()">
                            <i class="fas fa-play-circle"></i> PLACE GAME (Manual)
                        </button>
                    </div>
                </div>
                
                <!-- AUTO BET SECTION -->
                <div class="auto-bet-section">
                    <h4 style="color: #856404; margin-bottom: 15px; text-align: center;">
                        <i class="fas fa-bolt"></i> Auto Bet
                    </h4>
                    
                    <div class="auto-bet-controls">
                        <button class="auto-bet-btn" id="auto-bet-btn" onclick="toggleAutoBet()">
                            <i class="fas fa-play"></i> Start Auto Betting
                        </button>
                        
                        <div class="auto-bet-status" id="auto-bet-status">
                            Ready to place random bets automatically. All balance in your wallet will be used.
                        </div>
                    </div>
                    
                    <!-- AUTO BET NUMBERS DISPLAY -->
                    <div class="auto-numbers-display" id="auto-numbers-display" style="display: none;">
                        <div class="auto-numbers-grid" id="auto-numbers-grid">
                            <!-- Auto generated numbers will appear here -->
                        </div>
                    </div>
                    
                    <!-- AUTO BET BALANCE SUMMARY -->
                    <div class="balance-summary" id="auto-balance-summary">
                        <div class="balance-row">
                            <span class="balance-label">Your Balance:</span>
                            <span class="balance-value decimal-format" id="auto-balance">‚Ç±50.000</span>
                        </div>
                        <div class="balance-row">
                            <span class="balance-label">Total Auto Bet:</span>
                            <span class="balance-value decimal-format" id="auto-total-bet">‚Ç±0.000</span>
                        </div>
                        <div class="balance-row">
                            <span class="balance-label">After Auto Bet:</span>
                            <span class="balance-value decimal-format" id="auto-after-bet">‚Ç±50.000</span>
                        </div>
                        <div class="fee-warning" id="auto-fee-warning"></div>
                    </div>
                    
                    <!-- AUTO PLACE GAME BUTTON -->
                    <div class="place-game-btn-container">
                        <button class="place-game-btn" id="auto-place-game-btn" onclick="placeAutoBet()">
                            <i class="fas fa-bolt"></i> PLACE GAME (Auto)
                        </button>
                    </div>
                </div>
                
                <div class="game-status" id="game-status" style="text-align: center; margin-top: 20px; padding: 10px; border-radius: 10px;">
                    <!-- Status messages -->
                </div>
                
                <div style="margin-top: 20px; text-align: center;">
                    <p style="color: #666; font-size: 14px;">
                        üéØ <strong>Game Rule:</strong> Lowest unique number wins!<br>
                        No duplicate numbers allowed. Format: X.XXX (e.g., 0.001, 1.111, 123.456)
                    </p>
                </div>
            </div>
        </div>
    </div>
    
    <!-- BET DETAILS MODAL -->
    <div id="bet-details-modal" class="modal hidden">
        <div class="modal-content">
            <button onclick="closeModal()" class="close-btn">&times;</button>
            <h3 id="bet-details-title" style="color: #667eea; text-align: center;">Bet Details</h3>
            
            <div class="bet-total" id="bet-details-total">
                Total Bet: <span class="decimal-format">‚Ç±0.000</span>
            </div>
            
            <div class="bet-numbers-grid" id="bet-details-numbers">
                <!-- Bet numbers will be displayed here -->
            </div>
            
            <div style="text-align: center; margin-top: 20px;">
                <button onclick="closeModal()" class="btn-primary">
                    <i class="fas fa-times"></i> Close
                </button>
            </div>
        </div>
    </div>
    
    <!-- WINNER DETAILS MODAL -->
    <div id="winner-details-modal" class="modal hidden">
        <div class="modal-content">
            <button onclick="closeModal()" class="close-btn">&times;</button>
            <h3 id="winner-details-title" style="color: #667eea; text-align: center;">Winner Details</h3>
            
            <div style="text-align: center; margin: 20px 0;">
                <img id="winner-item-image" src="" alt="Item" style="width: 100%; max-height: 200px; object-fit: cover; border-radius: 10px; margin: 15px 0;">
                <h4 id="winner-item-name" style="color: #28a745;"></h4>
                <div style="font-size: 24px; font-weight: bold; margin: 10px 0;" id="winner-item-price" class="decimal-format"></div>
            </div>
            
            <div style="background: #f8f9fa; padding: 15px; border-radius: 10px; margin: 15px 0;">
                <h4 style="color: #667eea; margin-bottom: 10px;">Winner Information</h4>
                <p><strong>Winner:</strong> <span id="winner-username"></span></p>
                <p><strong>Winning Number:</strong> <span id="winning-number" class="decimal-format"></span></p>
                <p><strong>Date Won:</strong> <span id="winner-date"></span></p>
            </div>
            
            <div style="text-align: center; margin-top: 20px;">
                <button onclick="closeModal()" class="btn-primary">
                    <i class="fas fa-times"></i> Close
                </button>
            </div>
        </div>
    </div>
    
    <!-- CASH IN MODAL -->
    <div id="cashin-modal" class="modal hidden">
        <div class="modal-content">
            <h3 style="color: #667eea; text-align: center;">üí∞ Cash In</h3>
            <p style="text-align: center; margin-bottom: 20px;">Select amount to deposit (expires in 5 days):</p>
            
            <div class="cashin-options">
                <button class="cashin-option" onclick="selectAmount(50)">‚Ç±50.000</button>
                <button class="cashin-option" onclick="selectAmount(100)">‚Ç±100.000</button>
                <button class="cashin-option" onclick="selectAmount(250)">‚Ç±250.000</button>
                <button class="cashin-option" onclick="selectAmount(500)">‚Ç±500.000</button>
                <button class="cashin-option" onclick="selectAmount(750)">‚Ç±750.000</button>
                <button class="cashin-option" onclick="selectAmount(1000)">‚Ç±1000.000</button>
            </div>
            
            <div class="selected-amount" style="text-align: center; margin: 30px 0; padding: 20px; background: #f0f8ff; border-radius: 10px;">
                <h4>Selected Amount</h4>
                <div style="font-size: 48px; font-weight: bold; color: #28a745;" id="selected-amount" class="decimal-format">0.000</div>
                <p style="margin-top: 10px;">‚è∞ Expires: <span id="expiry-date">--/--/----</span></p>
                <p class="service-fee">No service fee for deposits</p>
            </div>
            
            <button onclick="confirmCashIn()" class="btn-primary" style="margin-bottom: 10px;">
                <i class="fas fa-check-circle"></i> Confirm Cash In
            </button>
            <button onclick="closeModal()" class="btn-secondary">
                <i class="fas fa-times"></i> Cancel
            </button>
        </div>
    </div>
    
    <!-- ADD ITEM MODAL (ADMIN) -->
    <div id="add-item-modal" class="modal hidden">
        <div class="modal-content">
            <h3 style="color: #667eea; text-align: center;">‚ûï Add Raffle Item</h3>
            
            <div style="display: grid; gap: 15px; margin: 20px 0;">
                <input type="text" id="item-name-input" placeholder="Item Name (e.g., iPhone 15)" style="padding: 12px; border: 2px solid #ddd; border-radius: 8px;">
                
                <input type="number" id="item-price" placeholder="Price Value (‚Ç±)" style="padding: 12px; border: 2px solid #ddd; border-radius: 8px;">
                
                <input type="text" id="item-image-url" placeholder="Image URL" style="padding: 12px; border: 2px solid #ddd; border-radius: 8px;">
                
                <!-- START RAFFLE DATE & TIME -->
                <div>
                    <label class="form-label">Start Raffle Date & Time:</label>
                    <input type="datetime-local" id="start-date" class="datetime-input">
                </div>
                
                <!-- END RAFFLE DATE & TIME -->
                <div>
                    <label class="form-label">End Raffle Date & Time:</label>
                    <input type="datetime-local" id="end-date" class="datetime-input">
                </div>
                
                <!-- RAFFLE DAY DATE & TIME -->
                <div>
                    <label class="form-label">Raffle Day Date & Time:</label>
                    <input type="datetime-local" id="raffle-date" class="datetime-input">
                </div>
                
                <!-- WINNER DATE & TIME -->
                <div>
                    <label class="form-label">Winner Announcement Date & Time:</label>
                    <input type="datetime-local" id="winner-date" class="datetime-input">
                </div>
            </div>
            
            <button onclick="addNewItem()" class="btn-primary" style="margin-bottom: 10px;">
                <i class="fas fa-plus"></i> Add Item
            </button>
            <button onclick="closeModal()" class="btn-secondary">
                Cancel
            </button>
        </div>
    </div>
    
    <!-- WALLET SETUP MODAL -->
    <div id="wallet-modal" class="modal hidden">
        <div class="modal-content">
            <h3 style="color: #667eea; text-align: center;">üè¶ Setup E-Wallets</h3>
            
            <div style="margin: 20px 0;">
                <div style="margin-bottom: 15px;">
                    <label style="display: block; margin-bottom: 5px; font-weight: bold;">Shopee Wallet Number:</label>
                    <input type="text" id="shopee-input" placeholder="09XXXXXXXXX" style="width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 8px;">
                </div>
                
                <div style="margin-bottom: 25px;">
                    <label style="display: block; margin-bottom: 5px; font-weight: bold;">Lazada Wallet Number:</label>
                    <input type="text" id="lazada-input" placeholder="09XXXXXXXXX" style="width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 8px;">
                </div>
                
                <div style="background: #f8f9fa; padding: 10px; border-radius: 5px; margin-bottom: 15px;">
                    <p style="margin: 0; font-size: 14px; color: #666;">
                        <i class="fas fa-info-circle"></i> 2% service fee applies when transferring expired balances
                    </p>
                </div>
            </div>
            
            <button onclick="saveWalletInfo()" class="btn-primary" style="margin-bottom: 10px;">
                Save Wallet Information
            </button>
            <button onclick="closeModal()" class="btn-secondary">
                Cancel
            </button>
        </div>
    </div>
    
    <!-- TRANSFER MODAL -->
    <div id="transfer-modal" class="modal hidden">
        <div class="modal-content">
            <h3 style="color: #667eea; text-align: center;">üí∏ Transfer Expired Balance</h3>
            
            <div style="text-align: center; margin: 20px 0;">
                <div style="font-size: 36px; font-weight: bold; color: #28a745; margin: 15px 0;" id="transfer-amount" class="decimal-format">‚Ç±0.000</div>
                <p>Expired deposit needs to be transferred</p>
            </div>
            
            <div style="background: #fff3cd; padding: 15px; border-radius: 10px; margin: 20px 0;">
                <h4 style="color: #856404; margin-bottom: 10px;">Service Fee Information</h4>
                <p style="margin: 5px 0;"><strong>2% service fee</strong> will be deducted</p>
                <p style="margin: 5px 0;">Fee amount: <strong id="fee-amount" class="decimal-format">‚Ç±0.000</strong></p>
                <p style="margin: 5px 0;">Net amount after fee: <strong id="net-amount" class="decimal-format">‚Ç±0.000</strong></p>
            </div>
            
            <div style="margin: 25px 0;">
                <p style="text-align: center; font-weight: bold; margin-bottom: 15px;">Choose transfer method:</p>
                
                <div class="transfer-buttons">
                    <button class="transfer-btn shopee-btn" onclick="transferToShopee()">
                        <i class="fas fa-shopping-cart"></i> Shopee Wallet
                    </button>
                    <button class="transfer-btn lazada-btn" onclick="transferToLazada()">
                        <i class="fas fa-truck"></i> Lazada Wallet
                    </button>
                </div>
            </div>
            
            <button onclick="closeModal()" class="btn-secondary">
                Cancel
            </button>
        </div>
    </div>

    <!-- NOTIFICATION AREA -->
    <div id="notification-area" style="position: fixed; top: 20px; right: 20px; z-index: 1001;"></div>

    <!-- JAVASCRIPT -->
    <script>
        // ================ GLOBAL VARIABLES ================
        let currentUser = null;
        let currentItem = null;
        let selectedAmount = 0;
        let betNumber = '0.000';
        let currentDepositId = null;
        let serviceFeePercent = 2; // Changed from $2.00 to 2%
        let refundFeePercent = 2;
        let isAutoBetting = false;
        let autoBetInterval = null;
        let autoBetNumbers = [];
        let manualBetNumbers = [];
        let drawCheckInterval = null;
        let showAllLogs = false;
        let showAllDeposits = false;
        let showAllBets = false;
        let showAllWins = false;
        let showAllUsers = false;
        let showAllWinners = false;
        let showAllItems = false;
        
        // ================ INITIAL DATA ================
        function initializeData() {
            if (!localStorage.getItem('raffle_users')) {
                const demoUsers = {};
                for (let i = 1; i <= 5; i++) {
                    demoUsers[i] = {
                        username: i.toString(),
                        password: i.toString(),
                        balance: 50.000,
                        deposits: [],
                        walletInfo: { shopee: '', lazada: '' },
                        bets: [],
                        wins: [],
                        walletLogs: [],
                        serviceFees: 0.000
                    };
                }
                demoUsers['admin'] = {
                    username: 'admin',
                    password: 'secret123',
                    balance: 0.000,
                    deposits: [],
                    walletInfo: { shopee: '', lazada: '' },
                    bets: [],
                    isAdmin: true,
                    serviceFees: 0.000
                };
                localStorage.setItem('raffle_users', JSON.stringify(demoUsers));
            }
            
            if (!localStorage.getItem('raffle_items')) {
                const demoItems = [
                    {
                        id: 1,
                        name: "iPhone 15 Pro",
                        description: "Brand new iPhone 15 Pro 256GB",
                        image: "https://images.unsplash.com/photo-1695048133142-1a20484d2569?w=400&h=300&fit=crop",
                        price: 69999.000,
                        category: "electronics",
                        startDate: new Date().toISOString(),
                        endDate: new Date(Date.now() + 7 * 24 * 60 * 60 * 1000).toISOString(),
                        raffleDate: new Date(Date.now() + 7 * 24 * 60 * 60 * 1000).toISOString(),
                        winnerDate: new Date(Date.now() + 8 * 24 * 60 * 60 * 1000).toISOString(),
                        status: "active",
                        bets: [],
                        winner: null,
                        serviceFeesCollected: 0.000
                    },
                    {
                        id: 2,
                        name: "Samsung Galaxy S23",
                        description: "Latest Samsung flagship phone",
                        image: "https://images.unsplash.com/photo-1610945265064-0e34e5519bbf?w=400&h=300&fit=crop",
                        price: 45999.000,
                        category: "electronics",
                        startDate: new Date().toISOString(),
                        endDate: new Date(Date.now() + 5 * 24 * 60 * 60 * 1000).toISOString(),
                        raffleDate: new Date(Date.now() + 5 * 24 * 60 * 60 * 1000).toISOString(),
                        winnerDate: new Date(Date.now() + 6 * 24 * 60 * 60 * 1000).toISOString(),
                        status: "active",
                        bets: [],
                        winner: null,
                        serviceFeesCollected: 0.000
                    }
                ];
                localStorage.setItem('raffle_items', JSON.stringify(demoItems));
            }
            
            if (!localStorage.getItem('raffle_bets')) {
                localStorage.setItem('raffle_bets', JSON.stringify([]));
            }
            
            if (!localStorage.getItem('system_fees')) {
                localStorage.setItem('system_fees', JSON.stringify({
                    totalServiceFees: 0.000,
                    totalRefundFees: 0.000,
                    totalPotMoney: 0.000  // NEW: Track total pot money
                }));
            }
            
            // Start auto draw checker
            startAutoDrawChecker();
        }
        
        // ================ AUTO DRAW CHECKER ================
        function startAutoDrawChecker() {
            if (drawCheckInterval) clearInterval(drawCheckInterval);
            
            drawCheckInterval = setInterval(() => {
                checkAutoDraws();
            }, 60000); // Check every minute
        }
        
        function checkAutoDraws() {
            const items = JSON.parse(localStorage.getItem('raffle_items')) || [];
            const now = new Date();
            let drawsRun = 0;
            
            items.forEach(item => {
                if (item.status === 'active') {
                    const raffleDate = new Date(item.raffleDate);
                    
                    // Check if raffle date/time has passed
                    if (now >= raffleDate) {
                        runItemRaffle(item.id, true); // true = auto draw
                        drawsRun++;
                    }
                }
            });
            
            return drawsRun;
        }
        
        // ================ FORMAT FUNCTIONS ================
        function formatDecimal(value, decimals = 3) {
            return parseFloat(value).toFixed(decimals);
        }
        
        function formatCurrency(value) {
            return `‚Ç±${formatDecimal(value)}`;
        }
        
        function formatPercent(value) {
            return `${formatDecimal(value, 1)}%`;
        }
        
        // ================ LOGIN FUNCTIONS ================
        function fillLogin(username, password) {
            document.getElementById('username').value = username;
            document.getElementById('password').value = password;
        }
        
        function login() {
            const username = document.getElementById('username').value.trim();
            const password = document.getElementById('password').value;
            
            if (!username || !password) {
                showNotification('Please enter username and password', 'error');
                return;
            }
            
            initializeData();
            const users = JSON.parse(localStorage.getItem('raffle_users'));
            
            if (users[username] && users[username].password === password) {
                currentUser = username;
                
                if (users[username].isAdmin) {
                    showAdminDashboard();
                } else {
                    showUserDashboard();
                    checkDepositExpirations();
                }
                
                showNotification('Login successful!', 'success');
            } else {
                showNotification('Invalid username or password', 'error');
            }
        }
        
        function adminLogin() {
            document.getElementById('username').value = 'admin';
            document.getElementById('password').value = 'secret123';
            login();
        }
        
        // ================ DASHBOARD FUNCTIONS ================
        function showUserDashboard() {
            document.getElementById('login-screen').classList.add('hidden');
            document.getElementById('user-dashboard').classList.remove('hidden');
            document.getElementById('admin-dashboard').classList.add('hidden');
            
            // Initialize all collapsible sections as expanded
            initializeCollapsibleSections();
            
            loadUserData();
            loadRaffleItems();
            loadUserBets();
            loadUserWins();
        }
        
        function showAdminDashboard() {
            document.getElementById('login-screen').classList.add('hidden');
            document.getElementById('user-dashboard').classList.add('hidden');
            document.getElementById('admin-dashboard').classList.remove('hidden');
            
            // Initialize all collapsible sections as expanded
            initializeCollapsibleSections();
            
            loadAdminData();
        }
        
        function initializeCollapsibleSections() {
            // Set all collapsible sections to expanded by default
            const sections = [
                'active-raffles', 'wallet-logs', 'deposits', 'betting-history', 
                'my-wins', 'admin-users', 'admin-winners', 'admin-items'
            ];
            
            sections.forEach(sectionId => {
                const content = document.getElementById(`${sectionId}-content`);
                const icon = document.getElementById(`${sectionId}-icon`);
                
                if (content && icon) {
                    content.classList.add('expanded');
                    icon.classList.add('expanded');
                }
            });
        }
        
        function logout() {
            currentUser = null;
            currentItem = null;
            
            document.getElementById('login-screen').classList.remove('hidden');
            document.getElementById('user-dashboard').classList.add('hidden');
            document.getElementById('admin-dashboard').classList.add('hidden');
            
            document.getElementById('username').value = '';
            document.getElementById('password').value = '1';
            
            showNotification('Logged out successfully', 'success');
        }
        
        function showTab(tabName) {
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            document.querySelector(`[onclick="showTab('${tabName}')"]`).classList.add('active');
            document.getElementById(`${tabName}-tab`).classList.add('active');
            
            if (tabName === 'wallet') {
                loadDeposits();
                loadWalletLogs();
            } else if (tabName === 'bets') {
                loadUserBets();
            } else if (tabName === 'wins') {
                loadUserWins();
            }
        }
        
        // ================ COLLAPSIBLE FUNCTIONS ================
        function toggleCollapsible(sectionId) {
            const content = document.getElementById(`${sectionId}-content`);
            const icon = document.getElementById(`${sectionId}-icon`);
            
            if (content.classList.contains('expanded')) {
                content.classList.remove('expanded');
                icon.classList.remove('expanded');
            } else {
                content.classList.add('expanded');
                icon.classList.add('expanded');
            }
        }
        
        function viewAllLogs() {
            showAllLogs = !showAllLogs;
            loadWalletLogs();
        }
        
        function viewAllDeposits() {
            showAllDeposits = !showAllDeposits;
            loadDeposits();
        }
        
        function viewAllBets() {
            showAllBets = !showAllBets;
            loadUserBets();
        }
        
        function viewAllWins() {
            showAllWins = !showAllWins;
            loadUserWins();
        }
        
        function viewAllUsers() {
            showAllUsers = !showAllUsers;
            loadAdminData();
        }
        
        function viewAllWinners() {
            showAllWinners = !showAllWinners;
            loadAdminData();
        }
        
        function viewAllItems() {
            showAllItems = !showAllItems;
            loadAdminData();
        }
        
        // ================ USER DATA FUNCTIONS ================
        function loadUserData() {
            const users = JSON.parse(localStorage.getItem('raffle_users'));
            const user = users[currentUser];
            
            if (!user) return;
            
            document.getElementById('current-user').textContent = currentUser;
            document.getElementById('user-balance').textContent = formatDecimal(user.balance);
            document.getElementById('wallet-balance').textContent = formatDecimal(user.balance);
            
            // Update wallet info - show empty string if not set
            document.getElementById('shopee-wallet').textContent = user.walletInfo.shopee || '';
            document.getElementById('lazada-wallet').textContent = user.walletInfo.lazada || '';
        }
        
        function loadDeposits() {
            const users = JSON.parse(localStorage.getItem('raffle_users'));
            const user = users[currentUser];
            const depositsList = document.getElementById('deposits-list');
            
            if (!user.deposits || user.deposits.length === 0) {
                depositsList.innerHTML = '<p style="text-align: center; color: #999; padding: 20px;">No active deposits</p>';
                return;
            }
            
            // Sort by date (newest first)
            const sortedDeposits = [...user.deposits].sort((a, b) => 
                new Date(b.depositDate) - new Date(a.depositDate)
            );
            
            // Show only last 3 deposits by default, or all if showAllDeposits is true
            const depositsToShow = showAllDeposits ? sortedDeposits : sortedDeposits.slice(0, 3);
            
            let html = '';
            depositsToShow.forEach((deposit, index) => {
                const depositDate = new Date(deposit.depositDate);
                const expiryDate = new Date(deposit.expiryDate);
                const now = new Date();
                const timeDiff = expiryDate - now;
                const daysLeft = Math.ceil(timeDiff / (1000 * 60 * 60 * 24));
                const hoursLeft = Math.ceil((timeDiff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                
                let statusClass = '';
                let statusText = '';
                let actionButton = '';
                
                if (daysLeft <= 1 && daysLeft > 0) {
                    statusClass = 'expiring';
                    statusText = `<div style="color: #ff9800; font-size: 12px; margin-top: 5px;">
                        <i class="fas fa-exclamation-triangle"></i> Expires tomorrow!
                        <div class="countdown">${hoursLeft} hours remaining</div>
                    </div>`;
                } else if (daysLeft <= 0) {
                    statusClass = 'expired';
                    statusText = `<div style="color: #f44336; font-size: 12px; margin-top: 5px;">
                        <i class="fas fa-clock"></i> EXPIRED - Transfer required
                    </div>`;
                    actionButton = `<button onclick="showTransferModal(${index})" class="btn-warning" style="margin-top: 10px; width: 100%;">
                        <i class="fas fa-exchange-alt"></i> Transfer to E-Wallet
                    </button>`;
                }
                
                // Add source information if available
                let sourceInfo = '';
                if (deposit.source === 'refund') {
                    sourceInfo = `<div style="font-size: 11px; color: #28a745; margin-top: 5px;">
                        <i class="fas fa-undo"></i> Refund from ${deposit.sourceItem || 'raffle'} - ‚Ç±${formatDecimal(deposit.amount)}
                    </div>`;
                } else if (deposit.source === 'transfer') {
                    sourceInfo = `<div style="font-size: 11px; color: #17a2b8; margin-top: 5px;">
                        <i class="fas fa-paper-plane"></i> Received from ${deposit.sourceUser || 'another user'} - ‚Ç±${formatDecimal(deposit.amount)}
                    </div>`;
                } else if (deposit.source === 'cashin') {
                    sourceInfo = `<div style="font-size: 11px; color: #28a745; margin-top: 5px;">
                        <i class="fas fa-plus-circle"></i> Cash In deposit - ‚Ç±${formatDecimal(deposit.amount)}
                    </div>`;
                }
                
                html += `
                    <div class="deposit-item ${statusClass}" id="deposit-${index}">
                        <div style="display: flex; justify-content: space-between;">
                            <strong class="decimal-format">‚Ç±${formatDecimal(deposit.amount)}</strong>
                            <span>${daysLeft > 0 ? daysLeft + ' days left' : 'EXPIRED'}</span>
                        </div>
                        <div style="font-size: 12px; color: #666; margin-top: 5px;">
                            Deposited: ${depositDate.toLocaleDateString()} ${depositDate.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}<br>
                            Expires: ${expiryDate.toLocaleDateString()}
                        </div>
                        ${sourceInfo}
                        ${statusText}
                        ${actionButton}
                    </div>
                `;
            });
            
            depositsList.innerHTML = html;
            
            // Update View All button text
            const viewAllBtn = document.querySelector('#deposits-content .view-all-btn');
            if (viewAllBtn) {
                viewAllBtn.textContent = showAllDeposits ? 'Show Less' : 'View All Deposits';
            }
        }
        
        function loadWalletLogs() {
            const users = JSON.parse(localStorage.getItem('raffle_users'));
            const user = users[currentUser];
            const logsList = document.getElementById('wallet-logs-list');
            
            if (!user.walletLogs || user.walletLogs.length === 0) {
                logsList.innerHTML = '<p style="text-align: center; color: #999; padding: 20px;">No wallet activity yet</p>';
                return;
            }
            
            // Sort by date (newest first)
            const sortedLogs = [...user.walletLogs].sort((a, b) => 
                new Date(b.date) - new Date(a.date)
            );
            
            // Show only last 3 logs by default, or all if showAllLogs is true
            const logsToShow = showAllLogs ? sortedLogs : sortedLogs.slice(0, 3);
            
            let html = '';
            logsToShow.forEach(log => {
                const logDate = new Date(log.date);
                let logClass = '';
                let logIcon = '';
                let displayAmount = log.amount;
                let amountColor = '#28a745'; // Green for positive amounts
                
                switch(log.type) {
                    case 'bet':
                        logClass = 'bet';
                        logIcon = 'fas fa-dice';
                        amountColor = '#dc3545'; // Red for bets (money going out)
                        break;
                    case 'refund':
                        logClass = 'refund';
                        logIcon = 'fas fa-undo';
                        // Refunds are always positive amounts (money coming in)
                        amountColor = '#28a745';
                        break;
                    case 'refund-fee':
                        logClass = 'transfer-fee';
                        logIcon = 'fas fa-percentage';
                        amountColor = '#dc3545'; // Red for fees (money going out)
                        break;
                    case 'transfer-fee':
                        logClass = 'transfer-fee';
                        logIcon = 'fas fa-percentage';
                        amountColor = '#dc3545'; // Red for fees (money going out)
                        break;
                    case 'send':
                        logClass = 'send';
                        logIcon = 'fas fa-paper-plane';
                        // If amount is negative (sending), show red, if positive (receiving), show green
                        amountColor = log.amount < 0 ? '#dc3545' : '#28a745';
                        break;
                    case 'win':
                        logClass = 'win';
                        logIcon = 'fas fa-trophy';
                        amountColor = '#20c997'; // Teal for wins
                        break;
                    case 'deposit':
                        logClass = '';
                        logIcon = 'fas fa-plus-circle';
                        amountColor = '#28a745'; // Green for deposits (money coming in)
                        break;
                    case 'money-sent':
                        logClass = 'send';
                        logIcon = 'fas fa-paper-plane';
                        amountColor = '#dc3545'; // Red for sending money
                        break;
                    case 'money-received':
                        logClass = 'refund';
                        logIcon = 'fas fa-paper-plane';
                        amountColor = '#28a745'; // Green for receiving money
                        break;
                    case 'pot-money':
                        logClass = 'win';
                        logIcon = 'fas fa-money-bill-wave';
                        amountColor = '#20c997'; // Teal for pot money
                        break;
                    case 'pot-transfer':
                        logClass = 'send';
                        logIcon = 'fas fa-university';
                        amountColor = log.amount >= 0 ? '#20c997' : '#dc3545';
                        break;
                    default:
                        logIcon = 'fas fa-exchange-alt';
                        amountColor = log.amount >= 0 ? '#28a745' : '#dc3545';
                }
                
                // Format the amount display
                let amountDisplay = '';
                if (log.type === 'win' && log.amount === 0) {
                    amountDisplay = `<span style="color: ${amountColor}; font-weight: bold;">WON ITEM</span>`;
                } else {
                    amountDisplay = `<span class="decimal-format" style="font-weight: bold; color: ${amountColor}">
                        ${displayAmount >= 0 ? '+' : ''}‚Ç±${formatDecimal(Math.abs(displayAmount))}
                    </span>`;
                }
                
                html += `
                    <div class="log-item ${logClass}">
                        <div style="display: flex; justify-content: space-between;">
                            <div>
                                <i class="${logIcon}"></i> ${log.description}
                            </div>
                            <div>
                                ${amountDisplay}
                            </div>
                        </div>
                        <div style="font-size: 12px; color: #666; margin-top: 5px;">
                            ${logDate.toLocaleDateString()} ${logDate.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}
                        </div>
                    </div>
                `;
            });
            
            logsList.innerHTML = html;
            
            // Update View All button text
            const viewAllBtn = document.querySelector('#wallet-logs-content .view-all-btn');
            if (viewAllBtn) {
                viewAllBtn.textContent = showAllLogs ? 'Show Less' : 'View All Logs';
            }
        }
        
        function addWalletLog(userId, type, description, amount) {
            const users = JSON.parse(localStorage.getItem('raffle_users'));
            const user = users[userId];
            
            if (!user) return;
            
            if (!user.walletLogs) {
                user.walletLogs = [];
            }
            
            user.walletLogs.push({
                date: new Date().toISOString(),
                type: type,
                description: description,
                amount: amount
            });
            
            // Keep only last 50 logs
            if (user.walletLogs.length > 50) {
                user.walletLogs = user.walletLogs.slice(-50);
            }
            
            users[userId] = user;
            localStorage.setItem('raffle_users', JSON.stringify(users));
        }
        
        function addDeposit(userId, amount, source, sourceItem = '', sourceUser = '') {
            const users = JSON.parse(localStorage.getItem('raffle_users'));
            const user = users[userId];
            
            if (!user) return;
            
            if (!user.deposits) {
                user.deposits = [];
            }
            
            const deposit = {
                amount: amount,
                depositDate: new Date().toISOString(),
                expiryDate: new Date(Date.now() + 5 * 24 * 60 * 60 * 1000).toISOString(),
                status: 'active',
                notificationSent: false,
                expiredNotified: false,
                source: source, // 'cashin', 'refund', 'transfer'
                sourceItem: sourceItem, // For refunds: item name
                sourceUser: sourceUser // For transfers: sender username
            };
            
            user.deposits.push(deposit);
            
            // Keep only last 10 deposits
            if (user.deposits.length > 10) {
                user.deposits = user.deposits.slice(-10);
            }
            
            users[userId] = user;
            localStorage.setItem('raffle_users', JSON.stringify(users));
            
            // Log the deposit addition
            if (source === 'refund') {
                addWalletLog(userId, 'money-received', `Refund from ${sourceItem}`, amount);
            } else if (source === 'transfer') {
                addWalletLog(userId, 'money-received', `Received from ${sourceUser}`, amount);
            } else if (source === 'cashin') {
                addWalletLog(userId, 'deposit', 'Cash in deposit', amount);
            }
        }
        
        function checkDepositExpirations() {
            const users = JSON.parse(localStorage.getItem('raffle_users'));
            const user = users[currentUser];
            let hasExpiring = false;
            let hasExpired = false;
            
            if (!user.deposits) return;
            
            user.deposits.forEach((deposit, index) => {
                const expiryDate = new Date(deposit.expiryDate);
                const now = new Date();
                const timeDiff = expiryDate - now;
                const daysLeft = Math.ceil(timeDiff / (1000 * 60 * 60 * 24));
                
                // Day 4 notification (expires tomorrow)
                if (daysLeft === 1 && !deposit.notificationSent) {
                    showNotification(`Deposit of ‚Ç±${formatDecimal(deposit.amount)} expires tomorrow! Transfer to e-wallet to avoid loss.`, 'warning');
                    deposit.notificationSent = true;
                    hasExpiring = true;
                }
                
                // Expiry day notification (9 AM check)
                if (daysLeft <= 0 && !deposit.expiredNotified) {
                    const currentHour = now.getHours();
                    if (currentHour >= 9) {
                        showNotification(`Deposit of ‚Ç±${formatDecimal(deposit.amount)} has expired! Please transfer to your e-wallet.`, 'error');
                        deposit.expiredNotified = true;
                        hasExpired = true;
                    }
                }
                
                // Update status
                if (daysLeft <= 1 && daysLeft > 0) {
                    deposit.status = 'expiring';
                } else if (daysLeft <= 0) {
                    deposit.status = 'expired';
                }
            });
            
            if (hasExpiring || hasExpired) {
                users[currentUser] = user;
                localStorage.setItem('raffle_users', JSON.stringify(users));
                loadDeposits();
            }
        }
        
        function showTransferModal(depositIndex) {
            const users = JSON.parse(localStorage.getItem('raffle_users'));
            const user = users[currentUser];
            const deposit = user.deposits[depositIndex];
            
            if (!deposit || deposit.status !== 'expired') {
                showNotification('This deposit is not expired', 'error');
                return;
            }
            
            if (!user.walletInfo.shopee && !user.walletInfo.lazada) {
                showNotification('Please setup your e-wallets first', 'error');
                showWalletSetup();
                return;
            }
            
            currentDepositId = depositIndex;
            const feeAmount = parseFloat(deposit.amount) * (serviceFeePercent / 100);
            const netAmount = parseFloat(deposit.amount) - feeAmount;
            
            document.getElementById('transfer-amount').textContent = formatCurrency(deposit.amount);
            document.getElementById('fee-amount').textContent = formatCurrency(feeAmount);
            document.getElementById('net-amount').textContent = formatCurrency(netAmount > 0 ? netAmount : 0);
            
            document.getElementById('transfer-modal').classList.remove('hidden');
        }
        
        function transferToShopee() {
            const users = JSON.parse(localStorage.getItem('raffle_users'));
            const user = users[currentUser];
            const deposit = user.deposits[currentDepositId];
            
            if (!deposit) {
                // Direct transfer from balance
                const balance = parseFloat(user.balance);
                if (balance <= 0) {
                    showNotification('No balance to transfer', 'error');
                    return;
                }
                
                const feeAmount = balance * (serviceFeePercent / 100);
                const netAmount = balance - feeAmount;
                const systemFees = JSON.parse(localStorage.getItem('system_fees'));
                
                // Record service fee
                systemFees.totalServiceFees = parseFloat(systemFees.totalServiceFees) + feeAmount;
                localStorage.setItem('system_fees', JSON.stringify(systemFees));
                
                // Add wallet logs for transfer and fee
                addWalletLog(currentUser, 'send', `Transferred to Shopee wallet`, -balance);
                addWalletLog(currentUser, 'transfer-fee', 'Wallet transfer service fee', -feeAmount);
                
                // Clear balance
                user.balance = 0.000;
                
                users[currentUser] = user;
                localStorage.setItem('raffle_users', JSON.stringify(users));
                
                loadUserData();
                loadDeposits();
                loadWalletLogs();
                
                showNotification(`Transferred ‚Ç±${formatDecimal(balance)} to Shopee wallet. Net: ‚Ç±${formatDecimal(netAmount)} (${formatPercent(serviceFeePercent)} fee)`, 'success');
                return;
            }
            
            const feeAmount = parseFloat(deposit.amount) * (serviceFeePercent / 100);
            const netAmount = parseFloat(deposit.amount) - feeAmount;
            const systemFees = JSON.parse(localStorage.getItem('system_fees'));
            
            // Record service fee
            systemFees.totalServiceFees = parseFloat(systemFees.totalServiceFees) + feeAmount;
            localStorage.setItem('system_fees', JSON.stringify(systemFees));
            
            // Add wallet log for transfer fee
            addWalletLog(currentUser, 'transfer-fee', 'Wallet transfer service fee', -feeAmount);
            
            // Remove deposit
            user.deposits.splice(currentDepositId, 1);
            
            users[currentUser] = user;
            localStorage.setItem('raffle_users', JSON.stringify(users));
            
            closeModal();
            loadDeposits();
            loadUserData();
            loadWalletLogs();
            
            showNotification(`Transferred ‚Ç±${formatDecimal(deposit.amount)} to Shopee wallet. Net: ‚Ç±${formatDecimal(netAmount)} (${formatPercent(serviceFeePercent)} fee)`, 'success');
        }
        
        function transferToLazada() {
            const users = JSON.parse(localStorage.getItem('raffle_users'));
            const user = users[currentUser];
            const deposit = user.deposits[currentDepositId];
            
            if (!deposit) {
                // Direct transfer from balance
                const balance = parseFloat(user.balance);
                if (balance <= 0) {
                    showNotification('No balance to transfer', 'error');
                    return;
                }
                
                const feeAmount = balance * (serviceFeePercent / 100);
                const netAmount = balance - feeAmount;
                const systemFees = JSON.parse(localStorage.getItem('system_fees'));
                
                // Record service fee
                systemFees.totalServiceFees = parseFloat(systemFees.totalServiceFees) + feeAmount;
                localStorage.setItem('system_fees', JSON.stringify(systemFees));
                
                // Add wallet logs for transfer and fee
                addWalletLog(currentUser, 'send', `Transferred to Lazada wallet`, -balance);
                addWalletLog(currentUser, 'transfer-fee', 'Wallet transfer service fee', -feeAmount);
                
                // Clear balance
                user.balance = 0.000;
                
                users[currentUser] = user;
                localStorage.setItem('raffle_users', JSON.stringify(users));
                
                loadUserData();
                loadDeposits();
                loadWalletLogs();
                
                showNotification(`Transferred ‚Ç±${formatDecimal(balance)} to Lazada wallet. Net: ‚Ç±${formatDecimal(netAmount)} (${formatPercent(serviceFeePercent)} fee)`, 'success');
                return;
            }
            
            const feeAmount = parseFloat(deposit.amount) * (serviceFeePercent / 100);
            const netAmount = parseFloat(deposit.amount) - feeAmount;
            const systemFees = JSON.parse(localStorage.getItem('system_fees'));
            
            // Record service fee
            systemFees.totalServiceFees = parseFloat(systemFees.totalServiceFees) + feeAmount;
            localStorage.setItem('system_fees', JSON.stringify(systemFees));
            
            // Add wallet log for transfer fee
            addWalletLog(currentUser, 'transfer-fee', 'Wallet transfer service fee', -feeAmount);
            
            // Remove deposit
            user.deposits.splice(currentDepositId, 1);
            
            users[currentUser] = user;
            localStorage.setItem('raffle_users', JSON.stringify(users));
            
            closeModal();
            loadDeposits();
            loadUserData();
            loadWalletLogs();
            
            showNotification(`Transferred ‚Ç±${formatDecimal(deposit.amount)} to Lazada wallet. Net: ‚Ç±${formatDecimal(netAmount)} (${formatPercent(serviceFeePercent)} fee)`, 'success');
        }
        
        // ================ RAFFLE ITEMS FUNCTIONS ================
        function loadRaffleItems() {
            const items = JSON.parse(localStorage.getItem('raffle_items')) || [];
            const container = document.getElementById('raffle-items');
            
            const now = new Date();
            
            if (items.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #999; padding: 40px;">No raffle items available</p>';
                return;
            }
            
            // Sort by end date (newest first)
            const sortedItems = [...items].sort((a, b) => 
                new Date(b.endDate) - new Date(a.endDate)
            );
            
            // Show only last 3 items by default, or all if expanded
            const content = document.getElementById('active-raffles-content');
            const itemsToShow = content.classList.contains('expanded') ? sortedItems : sortedItems.slice(0, 3);
            
            let html = '';
            itemsToShow.forEach(item => {
                const startDate = new Date(item.startDate);
                const endDate = new Date(item.endDate);
                const raffleDate = new Date(item.raffleDate);
                const winnerDate = new Date(item.winnerDate);
                const daysLeft = Math.ceil((endDate - now) / (1000 * 60 * 60 * 24));
                const isActive = item.status === 'active' && now >= startDate && now <= endDate;
                const isEnded = item.status === 'completed' || now > endDate;
                
                html += `
                    <div class="item-card ${isEnded ? 'inactive' : ''}" onclick="${isActive ? `openGameModal(${item.id})` : ''}" style="${!isActive ? 'cursor: not-allowed;' : ''}">
                        <h4>${item.name} ${isEnded ? '(Ended)' : ''}</h4>
                        <p style="color: #666; font-size: 14px;">${item.description}</p>
                        <img src="${item.image}" alt="${item.name}">
                        <div class="item-info">
                            <div>
                                <strong style="color: #28a745;" class="decimal-format">‚Ç±${formatDecimal(item.price)}</strong><br>
                                <small>Prize Value</small>
                            </div>
                            <div style="text-align: right;">
                                <strong>${isActive ? daysLeft + ' days left' : 'ENDED'}</strong><br>
                                <small>${isActive ? 'Active' : 'Closed'}</small>
                            </div>
                        </div>
                        <div style="margin-top: 10px; font-size: 12px; color: #666; background: #f8f9fa; padding: 10px; border-radius: 8px;">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 3px;">
                                <span>Starts:</span>
                                <span>${startDate.toLocaleDateString()} ${startDate.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; margin-bottom: 3px;">
                                <span>Ends:</span>
                                <span>${endDate.toLocaleDateString()} ${endDate.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; margin-bottom: 3px;">
                                <span>Draw:</span>
                                <span>${raffleDate.toLocaleDateString()} ${raffleDate.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}</span>
                            </div>
                            <div style="display: flex; justify-content: space-between;">
                                <span>Winner:</span>
                                <span>${winnerDate.toLocaleDateString()} ${winnerDate.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}</span>
                            </div>
                        </div>
                        <div style="margin-top: 10px; text-align: center;">
                            <button class="${isActive ? 'btn-primary' : 'btn-secondary btn-disabled'}" style="padding: 10px 20px; font-size: 14px; width: 100%;" ${!isActive ? 'disabled' : ''}>
                                <i class="fas fa-play"></i> ${isActive ? 'Play Now' : 'Raffle Ended'}
                            </button>
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }
        
        // ================ GAME MODAL FUNCTIONS ================
        function openGameModal(itemId) {
            const items = JSON.parse(localStorage.getItem('raffle_items'));
            currentItem = items.find(item => item.id === itemId);
            
            if (!currentItem) return;
            
            const now = new Date();
            const endDate = new Date(currentItem.endDate);
            
            if (now > endDate || currentItem.status === 'completed') {
                showNotification('This raffle has ended', 'error');
                return;
            }
            
            document.getElementById('item-name').textContent = currentItem.name;
            document.getElementById('item-image').src = currentItem.image;
            
            // Reset betting state
            betNumber = '0.000';
            autoBetNumbers = [];
            manualBetNumbers = [];
            
            document.getElementById('bet-number').value = betNumber;
            document.getElementById('bet-number').classList.remove('has-value');
            
            // Reset auto bet display
            document.getElementById('auto-numbers-display').style.display = 'none';
            document.getElementById('auto-numbers-grid').innerHTML = '';
            
            // Reset auto betting
            stopAutoBet();
            
            // Update balance display
            updateManualBetSummary();
            updateAutoBetSummary();
            
            document.getElementById('game-modal').classList.remove('hidden');
        }
        
        function addNumber(num) {
            let currentNum = betNumber.replace(/\./g, '');
            
            if (num === '.') {
                if (betNumber.includes('.')) {
                    return; // Already has decimal point
                }
                // Add decimal point
                betNumber = currentNum.slice(0, 1) + '.' + currentNum.slice(1, 4).padEnd(3, '0');
            } else {
                // Add digit
                currentNum += num;
                if (currentNum.length > 4) {
                    currentNum = currentNum.slice(1, 5); // Keep only last 4 digits
                }
                
                // Format with decimal point
                if (currentNum.length <= 1) {
                    betNumber = '0.' + currentNum.padEnd(3, '0');
                } else {
                    betNumber = currentNum.slice(0, 1) + '.' + currentNum.slice(1, 4).padEnd(3, '0');
                }
            }
            
            document.getElementById('bet-number').value = betNumber;
            
            // Change color if not 0.000
            if (parseFloat(betNumber) > 0) {
                document.getElementById('bet-number').classList.add('has-value');
            } else {
                document.getElementById('bet-number').classList.remove('has-value');
            }
            
            updateManualBetSummary();
        }
        
        function clearNumber() {
            betNumber = '0.000';
            document.getElementById('bet-number').value = betNumber;
            document.getElementById('bet-number').classList.remove('has-value');
            updateManualBetSummary();
        }
        
        function updateManualBetSummary() {
            const users = JSON.parse(localStorage.getItem('raffle_users'));
            const user = users[currentUser];
            const balance = parseFloat(user.balance);
            const betAmountValue = parseFloat(betNumber);
            const afterBet = balance - betAmountValue;
            
            document.getElementById('manual-balance').textContent = formatCurrency(balance);
            document.getElementById('manual-bet-amount').textContent = formatCurrency(betAmountValue);
            document.getElementById('manual-after-bet').textContent = formatCurrency(afterBet);
            
            const feeWarning = document.getElementById('manual-fee-warning');
            const placeGameBtn = document.getElementById('manual-place-game-btn');
            
            if (afterBet < 0) {
                document.getElementById('manual-after-bet').style.color = '#f44336';
                feeWarning.textContent = 'Insufficient balance!';
                placeGameBtn.disabled = true;
                placeGameBtn.style.opacity = '0.6';
                placeGameBtn.innerHTML = '<i class="fas fa-exclamation-circle"></i> INSUFFICIENT BALANCE';
            } else if (betAmountValue <= 0) {
                document.getElementById('manual-after-bet').style.color = '#333';
                feeWarning.textContent = 'Enter a valid bet amount';
                placeGameBtn.disabled = true;
                placeGameBtn.style.opacity = '0.6';
                placeGameBtn.innerHTML = '<i class="fas fa-exclamation-circle"></i> ENTER BET AMOUNT';
            } else {
                document.getElementById('manual-after-bet').style.color = '#333';
                feeWarning.textContent = '';
                placeGameBtn.disabled = false;
                placeGameBtn.style.opacity = '1';
                placeGameBtn.innerHTML = '<i class="fas fa-play-circle"></i> PLACE GAME (Manual)';
            }
        }
        
        function updateAutoBetSummary() {
            const users = JSON.parse(localStorage.getItem('raffle_users'));
            const user = users[currentUser];
            const balance = parseFloat(user.balance);
            
            document.getElementById('auto-balance').textContent = formatCurrency(balance);
            
            // Calculate total auto bet amount
            let totalAutoBet = 0;
            autoBetNumbers.forEach(num => {
                totalAutoBet += parseFloat(num);
            });
            
            const afterAutoBet = balance - totalAutoBet;
            
            document.getElementById('auto-total-bet').textContent = formatCurrency(totalAutoBet);
            document.getElementById('auto-after-bet').textContent = formatCurrency(afterAutoBet);
            
            const feeWarning = document.getElementById('auto-fee-warning');
            const placeGameBtn = document.getElementById('auto-place-game-btn');
            
            if (autoBetNumbers.length === 0) {
                document.getElementById('auto-after-bet').style.color = '#333';
                feeWarning.textContent = 'Click "Start Auto Betting" to generate numbers';
                placeGameBtn.disabled = true;
                placeGameBtn.style.opacity = '0.6';
                placeGameBtn.innerHTML = '<i class="fas fa-exclamation-circle"></i> GENERATE NUMBERS FIRST';
            } else if (afterAutoBet < 0) {
                // ADJUSTMENT: Remove random numbers until balance is positive
                while (afterAutoBet < 0 && autoBetNumbers.length > 0) {
                    const randomIndex = Math.floor(Math.random() * autoBetNumbers.length);
                    const removedNumber = autoBetNumbers.splice(randomIndex, 1)[0];
                    totalAutoBet -= parseFloat(removedNumber);
                }
                
                // Update display after adjustment
                updateAutoBetNumbersDisplay();
                updateAutoBetSummary(); // Recursive call to update
            } else {
                document.getElementById('auto-after-bet').style.color = '#333';
                feeWarning.textContent = '';
                placeGameBtn.disabled = false;
                placeGameBtn.style.opacity = '1';
                placeGameBtn.innerHTML = '<i class="fas fa-bolt"></i> PLACE GAME (Auto)';
            }
        }
        
        function updateAutoBetNumbersDisplay() {
            const autoNumbersGrid = document.getElementById('auto-numbers-grid');
            autoNumbersGrid.innerHTML = '';
            
            autoBetNumbers.forEach((num, index) => {
                const badge = document.createElement('div');
                badge.className = 'auto-number-badge';
                badge.textContent = num;
                badge.title = `Bet #${index + 1}: ${num}`;
                autoNumbersGrid.appendChild(badge);
            });
            
            if (autoBetNumbers.length > 0) {
                document.getElementById('auto-numbers-display').style.display = 'block';
            }
        }
        
        function placeBet() {
            const betAmountValue = parseFloat(betNumber);
            
            if (isNaN(betAmountValue) || betAmountValue <= 0) {
                showNotification('Please enter a valid bet amount', 'error');
                return;
            }
            
            if (betAmountValue < 0.001 || betAmountValue > 999.999) {
                showNotification('Bet amount must be between 0.001 and 999.999', 'error');
                return;
            }
            
            const decimalPart = betNumber.split('.')[1];
            if (!decimalPart || decimalPart.length !== 3) {
                showNotification('Number must have exactly 3 decimal places (e.g., 0.123)', 'error');
                return;
            }
            
            const users = JSON.parse(localStorage.getItem('raffle_users'));
            const user = users[currentUser];
            
            if (parseFloat(user.balance) < betAmountValue) {
                showNotification('Insufficient balance! Please cash in.', 'error');
                return;
            }
            
            const bets = JSON.parse(localStorage.getItem('raffle_bets')) || [];
            
            // Check if number already exists for this item
            const existingBet = bets.find(bet => 
                bet.itemId === currentItem.id && bet.number === betAmountValue
            );
            
            if (existingBet) {
                showNotification('This number is already taken! Choose another.', 'error');
                return;
            }
            
            // Animate button
            const placeGameBtn = document.getElementById('manual-place-game-btn');
            placeGameBtn.classList.add('placed');
            placeGameBtn.innerHTML = '<i class="fas fa-check-circle"></i> BET PLACED!';
            
            const newBet = {
                id: Date.now(),
                userId: currentUser,
                itemId: currentItem.id,
                number: betAmountValue,
                amount: betAmountValue,
                placedAt: new Date().toISOString(),
                status: 'active',
                type: 'manual'
            };
            
            bets.push(newBet);
            localStorage.setItem('raffle_bets', JSON.stringify(bets));
            
            // Deduct exact bet amount
            user.balance = formatDecimal(parseFloat(user.balance) - betAmountValue);
            user.bets = user.bets || [];
            user.bets.push(newBet.id);
            users[currentUser] = user;
            localStorage.setItem('raffle_users', JSON.stringify(users));
            
            // Add bet to item
            const items = JSON.parse(localStorage.getItem('raffle_items'));
            const itemIndex = items.findIndex(item => item.id === currentItem.id);
            items[itemIndex].bets = items[itemIndex].bets || [];
            items[itemIndex].bets.push(newBet.id);
            localStorage.setItem('raffle_items', JSON.stringify(items));
            
            // Add wallet log for bet
            addWalletLog(currentUser, 'bet', `Bet placed on ${currentItem.name}`, -betAmountValue);
            
            // Add to manual bet tracking
            manualBetNumbers.push(betAmountValue);
            
            // Show success message
            const statusDiv = document.getElementById('game-status');
            statusDiv.innerHTML = `
                <div style="background: #d4edda; color: #155724; padding: 15px; border-radius: 10px;">
                    <h4><i class="fas fa-check-circle"></i> Bet Placed Successfully!</h4>
                    <p>Bet Number/Amount: <strong>${formatCurrency(betAmountValue)}</strong></p>
                    <p>Remaining Balance: <strong class="decimal-format">${formatCurrency(user.balance)}</strong></p>
                </div>
            `;
            
            // Update UI
            loadUserData();
            updateManualBetSummary();
            updateAutoBetSummary();
            loadWalletLogs();
            
            // Reset button after 2 seconds
            setTimeout(() => {
                placeGameBtn.classList.remove('placed');
                placeGameBtn.innerHTML = '<i class="fas fa-play-circle"></i> PLACE GAME (Manual)';
                
                // Clear bet number for next bet
                clearNumber();
                
                // Clear status after 3 seconds
                setTimeout(() => {
                    statusDiv.innerHTML = '';
                }, 3000);
            }, 2000);
        }
        
        // ================ AUTO BET FUNCTIONS ================
        function generateRandomNumber() {
            // Generate random number between 0.001 and 999.999 with 3 decimal places
            const wholePart = Math.floor(Math.random() * 1000);
            const decimalPart = Math.floor(Math.random() * 1000);
            const randomNum = parseFloat(`${wholePart}.${decimalPart.toString().padStart(3, '0')}`);
            
            // Ensure it's at least 0.001
            return Math.max(0.001, randomNum).toFixed(3);
        }
        
        function toggleAutoBet() {
            const autoBetBtn = document.getElementById('auto-bet-btn');
            const autoBetStatus = document.getElementById('auto-bet-status');
            const autoNumbersDisplay = document.getElementById('auto-numbers-display');
            
            if (!isAutoBetting) {
                // Start auto betting (generate numbers)
                const users = JSON.parse(localStorage.getItem('raffle_users'));
                const user = users[currentUser];
                const balance = parseFloat(user.balance);
                
                if (balance < 0.001) {
                    showNotification('Insufficient balance for auto betting', 'error');
                    return;
                }
                
                isAutoBetting = true;
                autoBetBtn.innerHTML = '<i class="fas fa-sync-alt fa-spin"></i> Generating...';
                autoBetBtn.disabled = true;
                autoBetStatus.innerHTML = `<span style="color: #28a745;"><i class="fas fa-spinner fa-spin"></i> Generating random numbers...</span>`;
                
                // Clear previous numbers
                autoBetNumbers = [];
                
                // Generate random numbers within balance
                let totalAmount = 0;
                let attempts = 0;
                const maxAttempts = 1000;
                
                while (totalAmount < balance && attempts < maxAttempts) {
                    attempts++;
                    const randomNum = generateRandomNumber();
                    const numValue = parseFloat(randomNum);
                    
                    // Check if adding this number would exceed balance
                    if (totalAmount + numValue <= balance) {
                        // Ensure uniqueness (not already in array)
                        if (!autoBetNumbers.includes(randomNum)) {
                            autoBetNumbers.push(randomNum);
                            totalAmount += numValue;
                        }
                    }
                    
                    // Stop if we have enough numbers or can't add more
                    if (autoBetNumbers.length >= 50) {
                        break;
                    }
                }
                
                // Update display
                updateAutoBetNumbersDisplay();
                
                // Show the display
                autoNumbersDisplay.style.display = 'block';
                
                // Update status
                autoBetStatus.innerHTML = `Generated ${autoBetNumbers.length} random numbers. Total: ${formatCurrency(totalAmount)}`;
                
                // Reset button
                setTimeout(() => {
                    isAutoBetting = false;
                    autoBetBtn.innerHTML = '<i class="fas fa-play"></i> Regenerate Numbers';
                    autoBetBtn.disabled = false;
                    updateAutoBetSummary();
                }, 500);
                
            } else {
                // Regenerate numbers
                toggleAutoBet(); // This will restart the process
            }
        }
        
        function stopAutoBet() {
            isAutoBetting = false;
            const autoBetBtn = document.getElementById('auto-bet-btn');
            const autoBetStatus = document.getElementById('auto-bet-status');
            
            autoBetBtn.innerHTML = '<i class="fas fa-play"></i> Start Auto Betting';
            autoBetBtn.disabled = false;
            autoBetStatus.innerHTML = 'Ready to place random bets automatically. All balance in your wallet will be used.';
            
            if (autoBetInterval) {
                clearInterval(autoBetInterval);
                autoBetInterval = null;
            }
        }
        
        function placeAutoBet() {
            if (autoBetNumbers.length === 0) {
                showNotification('No auto bet numbers generated', 'error');
                return;
            }
            
            const users = JSON.parse(localStorage.getItem('raffle_users'));
            const user = users[currentUser];
            const balance = parseFloat(user.balance);
            
            // Calculate total auto bet amount
            let totalAutoBet = 0;
            autoBetNumbers.forEach(num => {
                totalAutoBet += parseFloat(num);
            });
            
            if (balance < totalAutoBet) {
                showNotification('Insufficient balance for auto betting', 'error');
                return;
            }
            
            const bets = JSON.parse(localStorage.getItem('raffle_bets')) || [];
            const existingNumbers = bets.filter(bet => bet.itemId === currentItem.id).map(bet => bet.number);
            const newBets = [];
            
            let betsPlaced = 0;
            let totalAmount = 0;
            
            // Place each auto bet
            autoBetNumbers.forEach((num, index) => {
                const numValue = parseFloat(num);
                
                // Check if number already exists
                if (existingNumbers.includes(numValue)) {
                    return; // Skip this number
                }
                
                const newBet = {
                    id: Date.now() + index,
                    userId: currentUser,
                    itemId: currentItem.id,
                    number: numValue,
                    amount: numValue,
                    placedAt: new Date().toISOString(),
                    status: 'active',
                    type: 'auto'
                };
                
                newBets.push(newBet);
                existingNumbers.push(numValue);
                betsPlaced++;
                totalAmount += numValue;
            });
            
            if (betsPlaced === 0) {
                showNotification('Could not place auto bets (all numbers already taken)', 'error');
                return;
            }
            
            // Animate button
            const placeGameBtn = document.getElementById('auto-place-game-btn');
            placeGameBtn.classList.add('placed');
            placeGameBtn.innerHTML = '<i class="fas fa-check-circle"></i> AUTO BETS PLACED!';
            
            // Add all bets to storage
            newBets.forEach(bet => {
                bets.push(bet);
            });
            localStorage.setItem('raffle_bets', JSON.stringify(bets));
            
            // Deduct total bet amount
            user.balance = formatDecimal(parseFloat(user.balance) - totalAmount);
            
            // Add bet IDs to user
            user.bets = user.bets || [];
            newBets.forEach(bet => {
                user.bets.push(bet.id);
            });
            
            users[currentUser] = user;
            localStorage.setItem('raffle_users', JSON.stringify(users));
            
            // Add bets to item
            const items = JSON.parse(localStorage.getItem('raffle_items'));
            const itemIndex = items.findIndex(item => item.id === currentItem.id);
            items[itemIndex].bets = items[itemIndex].bets || [];
            newBets.forEach(bet => {
                items[itemIndex].bets.push(bet.id);
            });
            localStorage.setItem('raffle_items', JSON.stringify(items));
            
            // Add wallet log for bets
            addWalletLog(currentUser, 'bet', `Auto bets placed on ${currentItem.name}`, -totalAmount);
            
            // Show success message
            const statusDiv = document.getElementById('game-status');
            statusDiv.innerHTML = `
                <div style="background: #d4edda; color: #155724; padding: 15px; border-radius: 10px;">
                    <h4><i class="fas fa-check-circle"></i> ${betsPlaced} Auto Bets Placed Successfully!</h4>
                    <p>Total Bet Amount: <strong class="decimal-format">${formatCurrency(totalAmount)}</strong></p>
                    <p>Remaining Balance: <strong class="decimal-format">${formatCurrency(user.balance)}</strong></p>
                </div>
            `;
            
            // Update UI
            loadUserData();
            updateManualBetSummary();
            updateAutoBetSummary();
            loadWalletLogs();
            
            // Clear auto bet numbers
            autoBetNumbers = [];
            document.getElementById('auto-numbers-display').style.display = 'none';
            document.getElementById('auto-numbers-grid').innerHTML = '';
            
            // Reset button after 2 seconds
            setTimeout(() => {
                placeGameBtn.classList.remove('placed');
                placeGameBtn.innerHTML = '<i class="fas fa-bolt"></i> PLACE GAME (Auto)';
                
                // Clear status after 5 seconds
                setTimeout(() => {
                    statusDiv.innerHTML = '';
                }, 5000);
            }, 2000);
            
            showNotification(`Successfully placed ${betsPlaced} auto bets!`, 'success');
        }
        
        // ================ BET DETAILS FUNCTIONS ================
        function showBetDetails(itemId, itemName) {
            const bets = JSON.parse(localStorage.getItem('raffle_bets')) || [];
            const userBets = bets.filter(bet => bet.userId === currentUser && bet.itemId === itemId);
            
            if (userBets.length === 0) {
                showNotification('No bets found for this item', 'info');
                return;
            }
            
            // Calculate total bet amount for this item
            let totalAmount = 0;
            userBets.forEach(bet => {
                totalAmount += parseFloat(bet.amount);
            });
            
            // Update modal title
            document.getElementById('bet-details-title').textContent = `Bet Details: ${itemName}`;
            document.getElementById('bet-details-total').innerHTML = `Total Bet: <span class="decimal-format">${formatCurrency(totalAmount)}</span>`;
            
            // Display bet numbers
            const numbersGrid = document.getElementById('bet-details-numbers');
            numbersGrid.innerHTML = '';
            
            userBets.forEach((bet, index) => {
                const numberItem = document.createElement('div');
                numberItem.className = 'bet-number-item';
                numberItem.innerHTML = `
                    <div style="font-size: 14px; font-weight: bold;">${bet.number.toFixed(3)}</div>
                    <div style="font-size: 11px; color: #666;">${formatCurrency(bet.amount)}</div>
                    <div style="font-size: 10px; color: #999;">${new Date(bet.placedAt).toLocaleDateString()}</div>
                `;
                numbersGrid.appendChild(numberItem);
            });
            
            // Show modal
            document.getElementById('bet-details-modal').classList.remove('hidden');
        }
        
        // ================ WINNER FUNCTIONS ================
        function loadUserWins() {
            const users = JSON.parse(localStorage.getItem('raffle_users'));
            const items = JSON.parse(localStorage.getItem('raffle_items')) || [];
            const user = users[currentUser];
            
            const winsList = document.getElementById('wins-list');
            
            if (!user.wins || user.wins.length === 0) {
                winsList.innerHTML = '<p style="text-align: center; color: #999; padding: 40px;">No winning items yet. Keep playing!</p>';
                return;
            }
            
            // Sort by date (newest first)
            const sortedWins = [...user.wins].sort((a, b) => 
                new Date(b.winDate) - new Date(a.winDate)
            );
            
            // Show only last 3 wins by default, or all if expanded
            const content = document.getElementById('my-wins-content');
            const winsToShow = content.classList.contains('expanded') ? sortedWins : sortedWins.slice(0, 3);
            
            let html = '';
            winsToShow.forEach(win => {
                const item = items.find(i => i.id === win.itemId);
                if (item) {
                    const winDate = new Date(win.winDate);
                    html += `
                        <div class="winner-item-card">
                            <h4 style="color: #28a745;">${item.name}</h4>
                            <img src="${item.image}" alt="${item.name}">
                            <div style="margin-top: 10px;">
                                <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                                    <span>Prize Value:</span>
                                    <strong class="decimal-format">‚Ç±${formatDecimal(item.price)}</strong>
                                </div>
                                <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                                    <span>Winning Number:</span>
                                    <strong class="decimal-format">${win.winningNumber.toFixed(3)}</strong>
                                </div>
                                <div style="display: flex; justify-content: space-between;">
                                    <span>Date Won:</span>
                                    <span>${winDate.toLocaleDateString()}</span>
                                </div>
                            </div>
                        </div>
                    `;
                }
            });
            
            winsList.innerHTML = html;
        }
        
        function showWinnerDetails(itemId, winnerUserId) {
            const items = JSON.parse(localStorage.getItem('raffle_items'));
            const users = JSON.parse(localStorage.getItem('raffle_users'));
            
            const item = items.find(i => i.id === itemId);
            const winner = users[winnerUserId];
            
            if (!item || !item.winner || !winner) return;
            
            const winDate = new Date(item.winner.announcedAt || item.winnerDate);
            
            document.getElementById('winner-details-title').textContent = 'Winner Details';
            document.getElementById('winner-item-name').textContent = item.name;
            document.getElementById('winner-item-price').textContent = formatCurrency(item.price);
            document.getElementById('winner-item-image').src = item.image;
            document.getElementById('winner-username').textContent = winnerUserId;
            document.getElementById('winning-number').textContent = item.winner.winningNumber.toFixed(3);
            document.getElementById('winner-date').textContent = winDate.toLocaleDateString() + ' ' + winDate.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
            
            document.getElementById('winner-details-modal').classList.remove('hidden');
        }
        
        // ================ CASH IN FUNCTIONS ================
        function showCashIn() {
            selectedAmount = 0;
            document.getElementById('selected-amount').textContent = '0.000';
            
            const expiryDate = new Date(Date.now() + 5 * 24 * 60 * 60 * 1000);
            document.getElementById('expiry-date').textContent = expiryDate.toLocaleDateString();
            
            document.getElementById('cashin-modal').classList.remove('hidden');
        }
        
        function selectAmount(amount) {
            selectedAmount = amount;
            document.getElementById('selected-amount').textContent = formatDecimal(amount);
            
            document.querySelectorAll('.cashin-option').forEach(btn => {
                btn.style.background = '#f8f9fa';
                btn.style.color = '#333';
                btn.style.borderColor = '#dee2e6';
            });
            
            event.target.style.background = '#667eea';
            event.target.style.color = 'white';
            event.target.style.borderColor = '#667eea';
        }
        
        function confirmCashIn() {
            if (selectedAmount <= 0) {
                showNotification('Please select an amount', 'error');
                return;
            }
            
            const users = JSON.parse(localStorage.getItem('raffle_users'));
            const user = users[currentUser];
            
            // Add deposit with source information
            addDeposit(currentUser, selectedAmount, 'cashin');
            
            user.balance = formatDecimal(parseFloat(user.balance) + selectedAmount);
            
            // Add wallet log
            addWalletLog(currentUser, 'deposit', 'Cash in deposit', selectedAmount);
            
            users[currentUser] = user;
            localStorage.setItem('raffle_users', JSON.stringify(users));
            
            closeModal();
            loadUserData();
            loadDeposits();
            loadWalletLogs();
            
            showNotification(`Successfully cashed in ${formatCurrency(selectedAmount)}! Expires in 5 days.`, 'success');
        }
        
        // ================ SEND MONEY FUNCTIONS ================
        function sendMoney() {
            const recipient = document.getElementById('recipient').value.trim();
            const amount = parseFloat(document.getElementById('send-amount').value);
            
            if (!recipient || isNaN(amount) || amount <= 0) {
                showNotification('Please enter valid recipient and amount', 'error');
                return;
            }
            
            const users = JSON.parse(localStorage.getItem('raffle_users'));
            
            if (!users[recipient] || recipient === currentUser) {
                showNotification('Invalid recipient username', 'error');
                return;
            }
            
            if (parseFloat(users[currentUser].balance) < amount) {
                showNotification('Insufficient balance', 'error');
                return;
            }
            
            // Deduct from sender
            users[currentUser].balance = formatDecimal(parseFloat(users[currentUser].balance) - amount);
            
            // Add deposit to recipient with source information
            addDeposit(recipient, amount, 'transfer', '', currentUser);
            
            // Add to recipient's balance
            users[recipient].balance = formatDecimal(parseFloat(users[recipient].balance) + amount);
            
            // Add wallet logs
            addWalletLog(currentUser, 'money-sent', `Money sent to ${recipient}`, -amount);
            addWalletLog(recipient, 'money-received', `Money received from ${currentUser}`, amount);
            
            localStorage.setItem('raffle_users', JSON.stringify(users));
            
            document.getElementById('recipient').value = '';
            document.getElementById('send-amount').value = '';
            
            loadUserData();
            loadDeposits();
            loadWalletLogs();
            
            showNotification(`Successfully sent ${formatCurrency(amount)} to ${recipient}`, 'success');
        }
        
        // ================ ADMIN FUNCTIONS ================
        function loadAdminData() {
            const users = JSON.parse(localStorage.getItem('raffle_users'));
            const items = JSON.parse(localStorage.getItem('raffle_items')) || [];
            const bets = JSON.parse(localStorage.getItem('raffle_bets')) || [];
            const systemFees = JSON.parse(localStorage.getItem('system_fees'));
            
            let totalBalance = 0;
            let userCount = 0;
            let activeRaffles = 0;
            let totalBets = bets.length;
            let totalWinners = 0;
            let totalPotMoney = parseFloat(systemFees.totalPotMoney || 0);
            
            Object.keys(users).forEach(username => {
                if (!users[username].isAdmin) {
                    totalBalance += parseFloat(users[username].balance);
                    userCount++;
                    if (users[username].wins && users[username].wins.length > 0) {
                        totalWinners += users[username].wins.length;
                    }
                }
            });
            
            const now = new Date();
            items.forEach(item => {
                const endDate = new Date(item.endDate);
                if (item.status === 'active' && now <= endDate) activeRaffles++;
            });
            
            document.getElementById('total-users').textContent = userCount;
            document.getElementById('total-balance').textContent = formatCurrency(totalBalance);
            document.getElementById('active-raffles').textContent = activeRaffles;
            document.getElementById('total-bets').textContent = totalBets;
            document.getElementById('total-winners').textContent = totalWinners;
            document.getElementById('total-fees').textContent = formatCurrency(systemFees.totalServiceFees + systemFees.totalRefundFees);
            document.getElementById('total-pot-money').textContent = formatCurrency(totalPotMoney);
            
            // Load Users List (last 3 or all)
            const usersList = document.getElementById('users-list');
            let usersHtml = '';
            
            const userEntries = Object.entries(users).filter(([username]) => !users[username].isAdmin);
            const sortedUsers = userEntries.sort((a, b) => 
                parseFloat(b[1].balance) - parseFloat(a[1].balance)
            );
            
            const usersToShow = showAllUsers ? sortedUsers : sortedUsers.slice(0, 3);
            
            usersToShow.forEach(([username, user]) => {
                usersHtml += `
                    <div style="background: #f8f9fa; padding: 10px; border-radius: 8px; margin-bottom: 10px;">
                        <div style="display: flex; justify-content: space-between;">
                            <strong>${username}</strong>
                            <span class="decimal-format">‚Ç±${formatDecimal(user.balance)}</span>
                        </div>
                        <div style="font-size: 12px; color: #666;">
                            Wins: ${user.wins?.length || 0} | Bets: ${user.bets?.length || 0}
                            ${user.serviceFees > 0 ? `| Fees: ‚Ç±${formatDecimal(user.serviceFees)}` : ''}
                        </div>
                    </div>
                `;
            });
            
            usersList.innerHTML = usersHtml || '<p>No users found</p>';
            
            // Load Winners List (last 3 or all)
            const winnersList = document.getElementById('winners-list');
            let winnersHtml = '';
            
            const completedItems = items.filter(item => item.winner);
            const sortedWinners = completedItems.sort((a, b) => 
                new Date(b.winner.announcedAt || b.winnerDate) - new Date(a.winner.announcedAt || a.winnerDate)
            );
            
            const winnersToShow = showAllWinners ? sortedWinners : sortedWinners.slice(0, 3);
            
            winnersToShow.forEach(item => {
                if (item.winner) {
                    const winDate = new Date(item.winner.announcedAt || item.winnerDate);
                    winnersHtml += `
                        <div class="winner-card" onclick="showWinnerDetails(${item.id}, '${item.winner.userId}')">
                            <div style="display: flex; justify-content: space-between;">
                                <div>
                                    <strong>${item.name}</strong><br>
                                    <small>Winner: ${item.winner.userId}</small>
                                </div>
                                <div style="text-align: right;">
                                    <strong class="decimal-format">${item.winner.winningNumber.toFixed(3)}</strong><br>
                                    <small>${winDate.toLocaleDateString()}</small>
                                </div>
                            </div>
                        </div>
                    `;
                }
            });
            
            if (winnersHtml === '') {
                winnersList.innerHTML = '<p style="text-align: center; color: #999; padding: 20px;">No winners yet</p>';
            } else {
                winnersList.innerHTML = winnersHtml;
            }
            
            // Load Items List (last 3 or all)
            const itemsList = document.getElementById('admin-items-list');
            let itemsHtml = '';
            
            const sortedItems = items.sort((a, b) => 
                new Date(b.endDate) - new Date(a.endDate)
            );
            
            const itemsToShow = showAllItems ? sortedItems : sortedItems.slice(0, 3);
            
            itemsToShow.forEach(item => {
                const endDate = new Date(item.endDate);
                const now = new Date();
                const isActive = item.status === 'active' && now <= endDate;
                const isEnded = item.status === 'completed' || now > endDate;
                
                itemsHtml += `
                    <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 10px; border-left: 5px solid ${isActive ? '#28a745' : '#6c757d'}">
                        <div style="display: flex; justify-content: space-between; align-items: start;">
                            <div>
                                <strong>${item.name}</strong><br>
                                <small class="decimal-format">‚Ç±${formatDecimal(item.price)} ‚Ä¢ ${isActive ? 'ACTIVE' : 'ENDED'}</small>
                            </div>
                            <div style="text-align: right;">
                                <small>Bets: ${item.bets?.length || 0}</small><br>
                                <small>Ends: ${endDate.toLocaleDateString()}</small>
                            </div>
                        </div>
                        <div style="margin-top: 10px; display: flex; gap: 5px;">
                            <button onclick="runItemRaffle(${item.id})" class="${isEnded ? 'btn-disabled' : 'btn-success'}" style="padding: 5px 10px; font-size: 12px;" ${isEnded ? 'disabled' : ''}>
                                ${isEnded ? 'Ended' : 'Run Draw Now'}
                            </button>
                            <button onclick="deleteItem(${item.id})" class="btn-secondary" style="padding: 5px 10px; font-size: 12px; background: #dc3545;">
                                Delete
                            </button>
                        </div>
                    </div>
                `;
            });
            
            itemsList.innerHTML = itemsHtml || '<p>No raffle items</p>';
        }
        
        function checkExpirations() {
            const users = JSON.parse(localStorage.getItem('raffle_users'));
            let notifications = 0;
            
            Object.keys(users).forEach(username => {
                if (users[username].isAdmin) return;
                
                const user = users[username];
                if (!user.deposits) return;
                
                user.deposits.forEach(deposit => {
                    const expiryDate = new Date(deposit.expiryDate);
                    const now = new Date();
                    const daysLeft = Math.ceil((expiryDate - now) / (1000 * 60 * 60 * 24));
                    
                    if (daysLeft === 1 && !deposit.notificationSent) {
                        notifications++;
                        deposit.notificationSent = true;
                    }
                    
                    if (daysLeft <= 0 && !deposit.expiredNotified) {
                        const currentHour = now.getHours();
                        if (currentHour >= 9) {
                            notifications++;
                            deposit.expiredNotified = true;
                        }
                    }
                });
            });
            
            localStorage.setItem('raffle_users', JSON.stringify(users));
            showNotification(`Checked ${notifications} deposit expirations`, 'info');
        }
        
        function showAddItem() {
            const now = new Date();
            const nextWeek = new Date(now.getTime() + 7 * 24 * 60 * 60 * 1000);
            const weekAfter = new Date(nextWeek.getTime() + 7 * 24 * 60 * 60 * 1000);
            
            const formatDateTime = (date) => {
                return date.toISOString().slice(0, 16);
            };
            
            document.getElementById('item-name-input').value = '';
            document.getElementById('item-price').value = '';
            document.getElementById('item-image-url').value = 'https://images.unsplash.com/photo-1511707171634-5f897ff02aa9?w=400&h=300&fit=crop';
            document.getElementById('start-date').value = formatDateTime(now);
            document.getElementById('end-date').value = formatDateTime(nextWeek);
            document.getElementById('raffle-date').value = formatDateTime(nextWeek);
            document.getElementById('winner-date').value = formatDateTime(weekAfter);
            
            document.getElementById('add-item-modal').classList.remove('hidden');
        }
        
        function addNewItem() {
            const name = document.getElementById('item-name-input').value.trim();
            const price = parseFloat(document.getElementById('item-price').value);
            const image = document.getElementById('item-image-url').value.trim();
            const startDate = document.getElementById('start-date').value;
            const endDate = document.getElementById('end-date').value;
            const raffleDate = document.getElementById('raffle-date').value;
            const winnerDate = document.getElementById('winner-date').value;
            
            if (!name || isNaN(price) || !image || !startDate || !endDate || !raffleDate || !winnerDate) {
                showNotification('Please fill all fields', 'error');
                return;
            }
            
            const items = JSON.parse(localStorage.getItem('raffle_items')) || [];
            const newItem = {
                id: items.length > 0 ? Math.max(...items.map(i => i.id)) + 1 : 1,
                name: name,
                description: `Win this amazing ${name}`,
                image: image,
                price: price,
                category: "electronics",
                startDate: startDate,
                endDate: endDate,
                raffleDate: raffleDate,
                winnerDate: winnerDate,
                status: "active",
                bets: [],
                winner: null,
                serviceFeesCollected: 0.000
            };
            
            items.push(newItem);
            localStorage.setItem('raffle_items', JSON.stringify(items));
            
            closeModal();
            loadAdminData();
            loadRaffleItems();
            showNotification(`Added new raffle item: ${name}`, 'success');
        }
        
        function runItemRaffle(itemId, isAutoDraw = false) {
            const items = JSON.parse(localStorage.getItem('raffle_items'));
            const bets = JSON.parse(localStorage.getItem('raffle_bets')) || [];
            const users = JSON.parse(localStorage.getItem('raffle_users'));
            const systemFees = JSON.parse(localStorage.getItem('system_fees'));
            
            const itemIndex = items.findIndex(item => item.id === itemId);
            if (itemIndex === -1) return;
            
            const item = items[itemIndex];
            
            // BYPASS DATE CHECK - Always allow admin to run draw
            const now = new Date();
            const endDate = new Date(item.endDate);
            
            // Even if raffle hasn't ended yet, admin can run it
            if (!isAutoDraw && now < endDate) {
                if (!confirm('Raffle has not ended yet. Are you sure you want to run the draw now?')) {
                    return;
                }
            }
            
            const itemBets = bets.filter(bet => bet.itemId === itemId && bet.status === 'active');
            
            if (itemBets.length === 0) {
                showNotification('No bets placed for this item', 'warning');
                return;
            }
            
            // Find lowest unique number
            const numberCounts = {};
            itemBets.forEach(bet => {
                numberCounts[bet.number] = (numberCounts[bet.number] || 0) + 1;
            });
            
            const uniqueBets = itemBets.filter(bet => numberCounts[bet.number] === 1);
            
            if (uniqueBets.length === 0) {
                // No winner - refund all bets with 2% fee
                showNotification('No unique numbers found. Refunding all bets with 2% service fee.', 'info');
                
                let totalRefunded = 0;
                let totalFees = 0;
                
                itemBets.forEach(bet => {
                    const refundAmount = bet.amount * (1 - refundFeePercent/100);
                    const feeAmount = bet.amount * (refundFeePercent/100);
                    
                    if (users[bet.userId]) {
                        users[bet.userId].balance = formatDecimal(parseFloat(users[bet.userId].balance) + refundAmount);
                        users[bet.userId].serviceFees = formatDecimal(parseFloat(users[bet.userId].serviceFees || 0) + feeAmount);
                        
                        // Add deposit for the refund
                        addDeposit(bet.userId, refundAmount, 'refund', item.name);
                        
                        // Add wallet logs for refund and fee
                        addWalletLog(bet.userId, 'refund', `Bet refund for ${item.name} (no winner)`, refundAmount);
                        addWalletLog(bet.userId, 'refund-fee', `2% service fee on refund for ${item.name}`, -feeAmount);
                    }
                    
                    bet.status = 'refunded';
                    bet.refundAmount = refundAmount;
                    bet.feeAmount = feeAmount;
                    
                    totalRefunded += refundAmount;
                    totalFees += feeAmount;
                });
                
                // Update system fees
                systemFees.totalRefundFees = parseFloat(systemFees.totalRefundFees) + totalFees;
                
                items[itemIndex].status = 'completed';
                items[itemIndex].noWinner = true;
                items[itemIndex].serviceFeesCollected = formatDecimal(parseFloat(items[itemIndex].serviceFeesCollected) + totalFees);
                
                // Notify all users
                Object.keys(users).forEach(username => {
                    if (!users[username].isAdmin) {
                        // In real app, would send notification
                        console.log(`Notify ${username}: No winner. Bets refunded with 2% fee.`);
                    }
                });
                
                showNotification(`Refunded ‚Ç±${formatDecimal(totalRefunded)} to ${itemBets.length} users with 2% service fee (‚Ç±${formatDecimal(totalFees)})`, 'success');
            } else {
                // Find winner
                uniqueBets.sort((a, b) => a.number - b.number);
                const winningBet = uniqueBets[0];
                
                // Mark winner
                items[itemIndex].winner = {
                    userId: winningBet.userId,
                    winningNumber: winningBet.number,
                    announced: true,
                    announcedAt: new Date().toISOString()
                };
                items[itemIndex].status = 'completed';
                
                // Give prize item to winner (NOT balance)
                if (users[winningBet.userId]) {
                    // Add win to user's wins array
                    users[winningBet.userId].wins = users[winningBet.userId].wins || [];
                    users[winningBet.userId].wins.push({
                        itemId: item.id,
                        winningNumber: winningBet.number,
                        winDate: new Date().toISOString()
                    });
                    
                    winningBet.status = 'won';
                    
                    // Add wallet log for win (amount 0 since it's an item, not money)
                    addWalletLog(winningBet.userId, 'win', `Won ${item.name}`, 0);
                    
                    // CALCULATE WINNER'S TOTAL BET AMOUNT FOR THIS ITEM
                    let winnerTotalBet = 0;
                    itemBets.forEach(bet => {
                        if (bet.userId === winningBet.userId) {
                            winnerTotalBet += parseFloat(bet.amount);
                        }
                    });
                    
                    // ADD WINNER'S TOTAL BET AMOUNT TO TOTAL POT MONEY
                    systemFees.totalPotMoney = parseFloat(systemFees.totalPotMoney || 0) + winnerTotalBet;
                    
                    // Add wallet log for winner's bets going to pot
                    addWalletLog(winningBet.userId, 'pot-transfer', `${item.name} - Winning bets to money pot`, -winnerTotalBet);
                    
                    // Refund all OTHER users' bets with 2% service fee deduction
                    itemBets.forEach(bet => {
                        if (bet.userId !== winningBet.userId && users[bet.userId]) {
                            // Calculate refund with 2% service fee
                            const refundAmount = bet.amount * (1 - refundFeePercent/100);
                            const feeAmount = bet.amount * (refundFeePercent/100);
                            
                            // Add refund amount to user balance (after 2% fee)
                            users[bet.userId].balance = formatDecimal(parseFloat(users[bet.userId].balance) + refundAmount);
                            
                            // Track user's service fees
                            users[bet.userId].serviceFees = formatDecimal(parseFloat(users[bet.userId].serviceFees || 0) + feeAmount);
                            
                            // Add deposit for the refund (after fee)
                            addDeposit(bet.userId, refundAmount, 'refund', item.name);
                            
                            // Add wallet logs for refund and fee
                            addWalletLog(bet.userId, 'refund', `Bet refund for ${item.name} (lost - 2% fee)`, refundAmount);
                            addWalletLog(bet.userId, 'refund-fee', `2% service fee on refund for ${item.name}`, -feeAmount);
                            
                            // Update bet status
                            bet.status = 'refunded';
                            bet.refundAmount = refundAmount;
                            bet.feeAmount = feeAmount;
                            
                            // Add to system fees
                            systemFees.totalRefundFees = parseFloat(systemFees.totalRefundFees) + feeAmount;
                        }
                    });
                    
                    // Notify winner
                    showNotification(`Winner declared for ${item.name}: ${winningBet.userId} with number ${winningBet.number.toFixed(3)}. Winner's bets (‚Ç±${formatDecimal(winnerTotalBet)}) added to Total Money Pot.`, 'success');
                }
            }
            
            // Save everything
            localStorage.setItem('raffle_items', JSON.stringify(items));
            localStorage.setItem('raffle_bets', JSON.stringify(bets));
            localStorage.setItem('raffle_users', JSON.stringify(users));
            localStorage.setItem('system_fees', JSON.stringify(systemFees));
            
            // Update admin view
            loadAdminData();
            
            if (!isAutoDraw) {
                showNotification(`Raffle draw completed for ${item.name}`, 'success');
            }
        }
        
        // ================ CASH OUT POT FUNCTION ================
        function cashOutPot() {
            const systemFees = JSON.parse(localStorage.getItem('system_fees'));
            const potAmount = parseFloat(systemFees.totalPotMoney || 0);
            
            if (potAmount <= 0) {
                showNotification('Pot is empty!', 'warning');
                return;
            }
            
            if (confirm(`Cash out ‚Ç±${formatDecimal(potAmount)} from Total Money Pot?`)) {
                // Add wallet log for pot cash out (admin user)
                addWalletLog('admin', 'pot-money', 'Cashed out money pot', potAmount);
                
                // Reset pot to 0
                systemFees.totalPotMoney = 0.000;
                localStorage.setItem('system_fees', JSON.stringify(systemFees));
                
                // Update display
                loadAdminData();
                
                // Show success message
                showNotification(`‚Ç±${formatDecimal(potAmount)} transferred successfully! Total Money Pot reset to 0.`, 'success');
            }
        }
        
        function deleteItem(itemId) {
            if (!confirm('Are you sure you want to delete this raffle item?')) return;
            
            const items = JSON.parse(localStorage.getItem('raffle_items'));
            const filteredItems = items.filter(item => item.id !== itemId);
            
            localStorage.setItem('raffle_items', JSON.stringify(filteredItems));
            loadAdminData();
            showNotification('Item deleted successfully', 'success');
        }
        
        function resetAllData() {
            if (!confirm('This will reset ALL data to initial demo state. Continue?')) return;
            
            localStorage.removeItem('raffle_users');
            localStorage.removeItem('raffle_items');
            localStorage.removeItem('raffle_bets');
            localStorage.removeItem('system_fees');
            
            initializeData();
            loadAdminData();
            
            showNotification('All data reset to demo state', 'success');
        }
        
        // ================ WALLET FUNCTIONS ================
        function showWalletSetup() {
            const users = JSON.parse(localStorage.getItem('raffle_users'));
            const user = users[currentUser];
            
            document.getElementById('shopee-input').value = user.walletInfo.shopee || '';
            document.getElementById('lazada-input').value = user.walletInfo.lazada || '';
            
            document.getElementById('wallet-modal').classList.remove('hidden');
        }
        
        function saveWalletInfo() {
            const shopee = document.getElementById('shopee-input').value.trim();
            const lazada = document.getElementById('lazada-input').value.trim();
            
            const users = JSON.parse(localStorage.getItem('raffle_users'));
            const user = users[currentUser];
            
            user.walletInfo = {
                shopee: shopee,
                lazada: lazada
            };
            
            users[currentUser] = user;
            localStorage.setItem('raffle_users', JSON.stringify(users));
            
            closeModal();
            loadUserData();
            
            showNotification('Wallet information saved successfully', 'success');
        }
        
        function loadUserBets() {
            const users = JSON.parse(localStorage.getItem('raffle_users'));
            const bets = JSON.parse(localStorage.getItem('raffle_bets')) || [];
            const items = JSON.parse(localStorage.getItem('raffle_items'));
            
            const user = users[currentUser];
            if (!user.bets || user.bets.length === 0) {
                document.getElementById('bets-list').innerHTML = 
                    '<p style="text-align: center; color: #999; padding: 40px;">No bets placed yet. Start playing!</p>';
                return;
            }
            
            const userBets = bets.filter(bet => bet.userId === currentUser);
            
            // Group bets by item
            const betsByItem = {};
            userBets.forEach(bet => {
                if (!betsByItem[bet.itemId]) {
                    betsByItem[bet.itemId] = {
                        item: items.find(i => i.id === bet.itemId),
                        bets: []
                    };
                }
                betsByItem[bet.itemId].bets.push(bet);
            });
            
            // Sort by date (newest first)
            const sortedBets = Object.entries(betsByItem).sort((a, b) => 
                new Date(b[1].bets[0].placedAt) - new Date(a[1].bets[0].placedAt)
            );
            
            // Show only last 3 bets by default, or all if expanded
            const content = document.getElementById('betting-history-content');
            const betsToShow = content.classList.contains('expanded') ? sortedBets : sortedBets.slice(0, 3);
            
            let html = '';
            betsToShow.forEach(([itemId, itemData]) => {
                const item = itemData.item;
                const itemBets = itemData.bets;
                
                // Calculate total bet amount for this item
                let totalBetAmount = 0;
                itemBets.forEach(bet => {
                    totalBetAmount += parseFloat(bet.amount);
                });
                
                const placedDate = new Date(itemBets[0].placedAt);
                let statusClass = '';
                let statusText = '';
                
                // Check if any bet is won
                const hasWon = itemBets.some(bet => bet.status === 'won');
                const hasRefunded = itemBets.some(bet => bet.status === 'refunded');
                const itemEnded = item && item.status === 'completed';
                
                if (hasWon) {
                    statusClass = 'won';
                    statusText = `<span style="color: #28a745; font-weight: bold;">WON!</span>`;
                } else if (hasRefunded) {
                    statusClass = 'refunded';
                    statusText = `<span style="color: #6c757d;">Refunded</span>`;
                } else if (itemEnded) {
                    statusClass = 'inactive';
                    statusText = `<span style="color: #6c757d;">Inactive (Raffle Ended)</span>`;
                } else {
                    statusText = `<span style="color: #667eea;">Active</span>`;
                }
                
                html += `
                    <div class="bet-item ${statusClass}" onclick="showBetDetails(${itemId}, '${item?.name || 'Unknown Item'}')">
                        <div style="display: flex; justify-content: space-between;">
                            <strong>${item?.name || 'Unknown Item'} ${itemEnded ? '(Ended)' : ''}</strong>
                            <span style="color: #667eea;" class="decimal-format">‚Ç±${formatDecimal(totalBetAmount)}</span>
                        </div>
                        <div style="margin-top: 5px;">
                            <span style="background: #e0e7ff; color: #667eea; padding: 3px 8px; border-radius: 15px; font-size: 12px;">
                                ${itemBets.length} bet${itemBets.length > 1 ? 's' : ''}
                            </span>
                            <span style="margin-left: 10px;">${statusText}</span>
                        </div>
                        <div style="font-size: 12px; color: #666; margin-top: 5px;">
                            First bet: ${placedDate.toLocaleDateString()} ${placedDate.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}
                        </div>
                        <div style="font-size: 11px; color: #999; margin-top: 5px; text-align: center;">
                            <i class="fas fa-hand-pointer"></i> Click to view bet details
                        </div>
                    </div>
                `;
            });
            
            document.getElementById('bets-list').innerHTML = html;
        }
        
        // ================ UTILITY FUNCTIONS ================
        function closeModal() {
            document.querySelectorAll('.modal').forEach(modal => {
                modal.classList.add('hidden');
            });
        }
        
        function showNotification(message, type = 'info') {
            const notificationArea = document.getElementById('notification-area');
            
            let backgroundColor = '#667eea';
            let icon = 'fas fa-info-circle';
            
            switch(type) {
                case 'success':
                    backgroundColor = '#28a745';
                    icon = 'fas fa-check-circle';
                    break;
                case 'error':
                    backgroundColor = '#dc3545';
                    icon = 'fas fa-exclamation-circle';
                    break;
                case 'warning':
                    backgroundColor = '#ffc107';
                    icon = 'fas fa-exclamation-triangle';
                    break;
                case 'info':
                    backgroundColor = '#17a2b8';
                    icon = 'fas fa-info-circle';
                    break;
            }
            
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.innerHTML = `
                <div style="display: flex; align-items: center; gap: 10px;">
                    <i class="${icon}" style="font-size: 20px;"></i>
                    <span>${message}</span>
                </div>
            `;
            notification.style.background = backgroundColor;
            
            notificationArea.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 5000);
        }
        
        // ================ INITIALIZATION ================
        window.onload = function() {
            initializeData();
            showNotification('Welcome to Raffle Game Prototype! Use username 1-5 with same password.', 'info');
        };
    </script>
</body>
</html>
